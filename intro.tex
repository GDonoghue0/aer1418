\chapter{Introduction to variational formulation and finite element methods}

\disclaimer

\section{Motivation}

\section{Model problem: strong formulation}
We consider a one-dimensional boundary value problem: find $u$ such that
\begin{align}
  - \dd{^2u}{x^2} &= f \quad \text{in } \Omega \equiv (0,1) \label{eq:intro_strong} \\
  u(x=0) = u(x=1) &= 0 , 
\end{align}
for $f$ a continuous function.  We may integrate the ODE twice to readily confirm the existence of a unique solution.  We will refer to this particular form of the problem as the \emph{strong form}.

One concrete application of the model equation is an elastic bar with fixed ends subjected to distributed force.  The bar is then modeled as
\begin{align*}
  \sigma &= EA \dd{u}{x} \quad &\text{(Hooke's law)} \\
  \dd{\sigma}{x} &= f \quad &\text{(force equilibrium)} \\
  u(x=0) = u(x=1) &=0 \quad &\text{(fixed ends)};
\end{align*}
here $u$ is the displacement, $\sigma$ is the internal force (i.e. area weighted stress), $E$ is the Young's modulus, $A$ is the cross sectional area, and $f$ is the distributed external force. We recognize that the problem fits in the model equation~\eqref{eq:intro_strong}.

\section{Minimization formulation}
We now consider a \emph{minimization form} of the model problem~\eqref{eq:intro_strong}.  To this end, we first introduce a linear space
\begin{align}
  \calV \equiv \{ v \ | \
  & v \text{ is continuous on $\Omega$, } \\
  & \dd{v}{x} \text{ is piecewise continuous and bounded on $\Omega$, and } \\
  & v(x=0) = v(x=1) = 0 \}.
  \label{eq:intro_V}
\end{align}
We then define a functional $J: \calV \to \RR$,
\begin{equation}
  J(w) \equiv \frac{1}{2} \int_\Omega \left( \dd{w}{x} \right)^2 dx - \int_\Omega f w dx \quad \forall w \in \calV.
  \label{eq:intro_J}
\end{equation}
Our \emph{minimization problem} is as follows: find $u \in \calV$ such that
\begin{equation}
  u = \arginf_{w \in \calV} J(w).
  \label{eq:intro_min}
\end{equation}
For a physical system with intrinsic energy, such as the elastic bar problem, the functional $J$ represents the total energy in the system; our minimization statement is hence a statement of energy minimization at equilibrium. 

We can readily show that the solution to the strong form~\eqref{eq:intro_strong} solves the minimization problem~\eqref{eq:intro_min}.  To see this, let $w = u + v$, where $u \in \calV$ is the solution to~\eqref{eq:intro_strong} and $v$ is an arbitrary function in $\calV$.  We then note that the functional $J(w) = J(u+v)$ can be decomposed into three terms:
\begin{align*}
  J(u+v) &= \frac{1}{2} \int_{\Omega} \left( \dd{(u+v)}{x} \right)^2 dx - \int_\Omega f(u+v) dx \\
  &= \underbrace{ \frac{1}{2} \int_{\Omega} \left( \dd{u}{x} \right)^2 dx - \int_\Omega f u dx }_{J(u)}
  + \underbrace{ \int_{\Omega} \dd{v}{x} \dd{u}{x} dx - \int_\Omega f v dx }_{J'(u;v) \text{ --- first variation}}
  + \underbrace{ \frac{1}{2} \int_{\Omega} \left( \dd{v}{x} \right)^2 dx }_{> 0 \text{ for } v \neq 0}.
\end{align*}
Here, the first variation $J'(u;v)$ should be interpreted as the first variation of $J$ about $u$ in the direction of $v$.  We integrate by parts $J'(u;v)$ to obtain
\begin{align*}
  J'(u;v) &= \int_{\Omega} \dd{v}{x} \dd{u}{x} dx - \int_\Omega f v dx
  =
  - \int_{\Omega} v ( \underbrace{ \dd{^2u}{x^2} + f}_{= 0 \text{ as $u$ solves \eqref{eq:intro_strong}}} ) dx + \underbrace{ \left[ v \dd{u}{x} \right]_{x=0}^1 }_{= 0 \text{ as $v$ is in $\calV$}}
  = 0;
\end{align*}
in other words, if $u$ is the solution to the strong form~\eqref{eq:intro_strong}, then $J'(u;v) = 0$ for all $v \in \calV$. It thus follows
\begin{align*}
  J(u + v) = J(u) + \frac{1}{2} \left( \dd{v}{x} \right)^2 dx
  > J(u)  \quad \text{for all $v \neq 0$}.
\end{align*}
It follows that the solution $u$ to the strong form~\eqref{eq:intro_strong} is also the solution to the minimization form~\eqref{eq:intro_min}.

\section{Variational form}
We now consider a \emph{variational form} of the model problem~\eqref{eq:intro_strong}. As in the minimization form, we work with the function space~$\calV$ defined in~\eqref{eq:intro_V}. Our \emph{variational problem} is as follows: find $u \in \calV$ such that
We then introduce a \emph{bilinear form} $a: \calV \times \calV \to \RR$,
\begin{equation}
  a(w,v) \equiv \int_{\Omega} \dd{v}{x} \dd{w}{x} dx \quad \forall w, v \in \calV,
  \label{eq:intro_a}
\end{equation}
and a \emph{linear form} $\ell: \calV \to \RR$,
\begin{equation}
  \ell(v) \equiv \int_{\Omega} v f dx \quad \forall v \in \calV.
  \label{eq:intro_ell}
\end{equation}
Our \emph{variational problem} is as follows: find $u \in \calV$ such that
\begin{equation}
  a(u,v) = \ell(v) \quad \forall v \in \calV.
  \label{eq:intro_var}
\end{equation}
The form $\ell: \calV \to \RR$ is said to be \emph{linear form} because it is linear in the argument in the sense that
\begin{equation*}
  \ell(\alpha w + \beta v) = \alpha \ell(w) + \beta \ell(v) \quad \forall w,v \in \calV, \ \forall \alpha, \beta \in \RR.
\end{equation*}
The form $a: \calV \times \calV \to \RR$ is said to be \emph{bilinear form} because 
\begin{align*}
  a(w, \tilde v) & \text{ is a linear form in $w$ for a fixed $\tilde v$, and} \\
  a(\tilde w, v) & \text{ is a linear form in $v$ for a fixed $\tilde w$}.
\end{align*}

We can readily show that $u \in \calV$ is the solution to the variational problem~\eqref{eq:intro_var} if and only if it is the solution to the minimization problem~\eqref{eq:intro_min}.  Suppose that $u \in \calV$ is the solution to the variational problem~\eqref{eq:intro_var}.  Then, for $w = u + v$ for any $v \in \calV$, we obtain
\begin{align*}
  J(w) = J(u + v) = J(u) + \underbrace{ \int_{\Omega} \dd{v}{x} \dd{u}{x} dx - \int_\Omega f v dx}_{= a(u,v) - \ell(v) = 0 \ \forall v \in \calV \text{ by \eqref{eq:intro_var}}}
  + \underbrace{ \frac{1}{2} \int_{\Omega} \left( \dd{v}{x} \right)^2 dx }_{> 0 \text{ for } v \neq 0} > J(u) \quad \forall v \neq 0;
\end{align*}
hence the solution $u \in \calV$ of the variational problem~\eqref{eq:intro_var} solves the minimization problem~\eqref{eq:intro_min}. 
Conversely, suppose $u \in \calV$ is the solution to the minimization problem~\eqref{eq:intro_min}.  Then, we know that $u$ must be a stationary point of $J$: i.e., $J'(u;v) = 0$, $\forall v \in \calV$; we hence require
\begin{equation*}
  J'(u;v) \equiv
  \int_{\Omega} \dd{v}{x} \dd{u}{x} dx
  - \int_{\Omega} f v dx
  = a(u,v) - \ell(v) = 0 \quad \forall v \in \calV,
\end{equation*}
which in fact is the equivalent condition to our variational statement~\eqref{eq:intro_var}. Hence we conclude that $u \in \calV$ is the solution to~\eqref{eq:intro_var} if and only if it is the solution to~\eqref{eq:intro_min}.  We will soon see that we can derive a finite element approximation from either~\eqref{eq:intro_var} or \eqref{eq:intro_min}.

\section{Finite element (FE) approximation}
In order to construct a finite element (FE) approximation, we must choose a suitable subspace of $\calV$ that well approximates $\calV$ and is amenable to computer implementation. To this end, we first \emph{discretize} (or \emph{tessellate}) the domain $\Omega \equiv (0,1)$ into $N+1$ non-overlapping segments; we introduce points
\begin{equation*}
  0 \equiv x_0 < x_1 < \cdots < x_N < x_{N+1} \equiv 1
\end{equation*}
and segments
\begin{equation*}
  I_i \equiv (x_{i-1}, x_i) \quad i = 1,\dots,N+1.
\end{equation*}
We denote the length of each segment by $h_i \equiv x_i - x_{i-1}$, $i = 1,\dots,N+1$.  We denote \emph{tessellation} of the domain $\Omega$ by
\begin{equation}
  \calT_h \equiv \{ I_i \}_{i=1}^{N+1};
  \label{eq:intro_Th}
\end{equation}
a tessellation $\calT_h$ is parametrized by a characteristic length $h \equiv \max_{i=\{ 1,\dots,N+1\}} h_i$.

We now introduce a space of piecewise linear functions associated with our tessellation $\calT_h$ and belong to $\calV$:
\begin{equation}
  \calV_h \equiv \{ v \in \calV \ | \ v|_{I_i} \in \PP^1(I_i), \ i = 1,\dots,N+1\}.
  \label{eq:intro_Vh}
\end{equation}
We make a few observations.  First, we require $v \in \calV$; we recall that this that i) $v$ must be continuous, ii) $\dd{v}{x}$ must be piecewise continuous and bounded, and iii) $v$ must vanish at the boundaries.  Second, we require $v|_{I_i} \in \PP^1(I_i)$, $i = 1,\dots,N+1$; in words, $v$ restricted to each segment $I_i$ is a linear polynomial.  Hence, any function in $\calV_h \subset \calV$ is piecewise linear and vanish at the boundaries.

We can now state our FE approximation problem in either the minimization form or the variational form.  The FE minimization form is as follows: find $u_h \in \calV_h$ such that
\begin{equation}
  u_h = \arginf_{v \in \calV_h} J(v),
  \label{eq:intro_min_fe}
\end{equation}
where $J: \calV \to \RR$ is the energy functional~\eqref{eq:intro_J}. (Note that $v \in \calV_h$ is an admissible argument of $J$ since $\calV_h \subset \calV$.) Similarly, the FE variational form is as follows: find $u_h \in \calV_h$ such that
\begin{equation}
  a(u_h,v) = \ell(v) \quad \forall v \in \calV_h,
  \label{eq:intro_var_fe}
\end{equation}
where $a: \calV \times \calV \to \RR$ and $\ell: \calV \to \RR$ are biilnear form~\eqref{eq:intro_a} and linear form~\eqref{eq:intro_ell}, respectively.  As before, $u_h \in \calV_h$ is the solution to the FE minimization problem~\eqref{eq:intro_min_fe} if and only if it is the solution to the FE variational problem~\eqref{eq:intro_var_fe}. We will henceforth refer to $u_h$ as the \emph{finite element solution}.

\section{Finite element approximation: implementation}
We now wish to implement~\eqref{eq:intro_var_fe} (or equivalently~\eqref{eq:intro_min_fe}).  To this end, we introduce a \emph{basis} for $\calV_h$ defined in~\eqref{eq:intro_Vh}.  A convenient basis for $\calV_h$ is a \emph{Lagrange basis} $\{\phi_i\}_{i=1}^N$ such that 
\begin{equation*}
  \phi_i(x_j) = \begin{cases}
    1 \quad j = i \\
    0 \quad j\neq i
  \end{cases},
  \quad j = 0,\dots,N+1,
\end{equation*}
where the interpolation points $\{ x_j \}_{j=0}^{N+1}$ are associated with the tessellation $\calT_h$. We can readily show that $\{ \phi_i \}_{i=1}^N$ is indeed a basis for $\calV_h$: i.e., $\calV_h = \text{span}\{ \phi_i \}_{i=1}^N$ and $\{\phi_i\}_{i=1}^N$ is linearly independent. We note that given the basis function, we can represent \emph{any} function $v \in \calV_h$ as
\begin{equation*}
  v(x) = \sum_{i=1}^N \hat v_i \phi_i(x), \quad x \in \Omega,
\end{equation*}
for some coefficients $\hat v \in \RR^N$.

We now restate the FE variational problem~\eqref{eq:intro_var_fe} using the basis and associated coefficients.  Specifically, we represent $u_h \in \calV_h$ and $v \in \calV_h$ as 
\begin{equation*}
  u_h \equiv \sum_{j=1}^N \hat u_{h,j} \phi_j \quad \text{and} \quad v \equiv \sum_{i=1}^N \hat v_i \phi_i
\end{equation*}
for some $\hat u_h \in \RR^N$ and $\hat v \in \RR^N$, and consider the following equivalent problem: find $\hat u_h \in \RR^N$ such that
\begin{equation}
  a(\sum_{j=1}^N \hat u_{h,j} \phi_j, \sum_{i=1}^N \hat v_i \phi_i) - \ell(\sum_{i=1}^N \hat v_i \phi_i)
  =
  \sum_{i=1}^N \sum_{j=1}^N \hat v_i a(\phi_j, \phi_i) \hat u_{h,j} -
  \sum_{i=1}^N \hat v_i \ell(\phi_i) = 0 \quad \forall \hat v \in \RR^N.
  \label{eq:intro_fe_disc_step_1}
\end{equation}
Here, we have appealed to the bilinearity and linearity of $a$ and $\ell$, respectively. We then note that in~\eqref{eq:intro_fe_disc_step_1} we can replace the condition $\forall \hat v \in \RR^N$ with an equivalent condition that the statement hold for $\hat v \in \{e_i \}_{i=1}^N$ for $\{e_i\}_{i=1}^N$ the canonical basis of $\RR^N$ (i.e.~$e_i \in \RR^N$ has $1$ in the $i$-th entry and $0$ elesewhere). Then, we can restate~\eqref{eq:intro_fe_disc_step_1} as follows: find $\hat u_h \in \RR^N$ such that
\begin{equation}
  \sum_{j=1}^N a(\phi_j,\phi_i) \hat u_{h,j} = \ell(\phi_i) \quad  \forall i = 1,\dots,N.
  \label{eq:intro_sys}
\end{equation}
We can also rewrite the linear system in matrix-vector form:
\begin{equation*}
  \underbrace{ \bmat{ccc}
  a(\phi_1,\phi_1) & \cdots & a(\phi_N,\phi_1) \\
  \vdots & \ddots & \vdots \\
  a(\phi_1,\phi_N) & \cdots & a(\phi_N,\phi_N) \\
  \emat
  }_{A_h \in \RR^{N \times N}}
  \underbrace{ \bmat{c} \hat u_{h,1}  \\ \vdots \\ \hat u_{h,N} \emat }_{\hat u_h \in \RR^N}
  =
  \underbrace{ \bmat{c} \ell(\phi_1) \\ \vdots \\ \ell(\phi_N) \emat }_{\hat f_h \in \RR^N},
\end{equation*}
or, more concisely,
\begin{equation*}
  A_h \hat u_h = f_h.
\end{equation*}
The matrix $A_h$ is called the \emph{stiffness matrix} and the vector $f_h$ is called the \emph{load vector}.

\section{An error estimate: optimality and polynomial approximation}
We now assess how well our FE solution $u_h \in \calV_h$ to~\eqref{eq:intro_var_fe} (or equivalently~\eqref{eq:intro_min_fe}) approximates the solution $u \in \calV$ to~\eqref{eq:intro_var} (or equivalently~\eqref{eq:intro_min} or \eqref{eq:intro_strong}).  To this end, we need to first define a norm with which we measure the ``closeness'' of the approximation. We in particular introduce the \emph{energy norm} associated with the model problem,
\begin{equation*}
  \enorm{v} \equiv \sqrt{a(v,v)}  = \left( \int_{\Omega} \left( \dd{v}{x} \right)^2 dx \right)^{1/2} \quad \forall v \in \calV.
\end{equation*}
Because $\enorm{ \cdot }$ is the induced norm associated with an inner product $a(\cdot,\cdot)$ over $\calV$, it is indeed a proper norm that satisfies i) scalability, ii) triangle inequality, and iii) positivity.  

We next state a key ingredient of the FE error estimate: \emph{Galerkin orthogonality}: since $\ell(v) = a(u,v)$, $\forall v \in \calV$, the FE variational statement~\eqref{eq:intro_var_fe} implies
\begin{equation*}
  \ell(v) - a(u_h,v) = a(u,v) - a(u_h,v) = a(u-u_h,v) \quad \forall v \in V_h;
\end{equation*}
the relationship is called Galerkin orthogonality because it states that the error $u - u_h$ is orthogonal to the space $\calV_h$ in the inner product $a(\cdot,\cdot)$. We now observe that, for any $w \in \calV_h$,
\begin{align*}
  \enorm{u-u_h}^2
  &=
  a(u-u_h, u-u_h) + \underbrace{a(u-u_h,u_h - w)}_{= 0 \text{ by Galerkin orthogonality}}
  =
  a(u-u_h, u - w)
  \leq \underbrace{ \enorm{u - u_h} \enorm{u - w} }_{\text{Cauchy-Schwarz}}.
\end{align*}
It follows that
\begin{equation}
  \enorm{u - u_h} \leq \enorm{u - w} \quad \forall w \in \calV_h,
  \label{eq:intro_fe_opt}
\end{equation}
or, equivalently,
\begin{equation*}
  \enorm{u-u_h} = \inf_{w \in \calV_h} \enorm{u - w}.
\end{equation*}
We observe that the FE approximation $u_h \in \calV_h$ is \emph{optimal} in the energy norm in the sense that it is the closest approximation to the solution $u \in \calV$ out of all elements in $\calV_h$.  In other words, even if we knew the solution $u$, we could not have found a better solution in $\calV_h$ than $u_h$.

As the optimality statement~\eqref{eq:intro_fe_opt} holds for any $w \in \calV_h$, we can set $w = \calI_h u$, the polynomial interpolant associated with our Lagrnage polynomial nodes.  It can be shown that for any $v \in \calV$ the following interpolation error bounds hold:
\begin{align*}
  \enorm{v - \calI_h v} &\leq \frac{1}{8} h^2 \max_{x \in \Omega} |v''(x)| \\
  \enorm{\dd{v}{x} - \dd{(\calI_h u)}{x}} &\leq h \max_{x \in \Omega} |v''(x)| .
\end{align*}
(We will later derive the bounds in a more formal setting.) We hence arrive at the following FE error bound in terms of the discretization parameter $h$:
\begin{equation*}
  \enorm{u - u_h} \leq \enorm{u - \calI_h u} \leq h \max_{x \in \Omega}  | u''(x) |.
\end{equation*}
