\chapter{Variational formulation}
\label{ch:var_form}
\disclaimer

\section{Introduction}
In the previous lecture, we developed the variational formulation and the associated finite element approximation for the one-dimensional Poisson equation with homogeneous Dirichlet boundary conditions. In this lecture, we focus on the derivation of the variational formulation for problems (i) in higher spatial dimensions, (ii) with more general boundary conditions, and (iii) governed by more general equations.  In addition, we discuss the well-posedness of the variational formulation.

\section{Hilbert and Banach spaces}
We start the section with an apology: it may be difficult to appreciate the formalism provided in this section and the next two at this point.  But, we introduce these spaces upfront such that we can state our weak formulations in a proper functional setting.  We will later see that this formalism allows us to provide various theoretical results about the weak formulation and the associated finite element approximation; this strong theoretical foundation is a strength of the finite element method. 

The solutions to the PDEs are most naturally sought in Hilbert spaces. By way of preliminaries, we recall the definition of a \emph{linear space}, \emph{norm}, and \emph{inner product}. (We limit ourselves to spaces of real-valued functions; however the following statements readily extend to spaces of complex-valued functions.)
\begin{definition}[linear space]
  $\calV$ is a linear space if the following conditions hold.
  \begin{enumerate}
  \item If $w,v \in \calV$, then $w + v \in \calV$.
  \item If $w \in \calV$ and $\alpha \in \RR$, then $\alpha w \in \calV$.
  \end{enumerate}
\end{definition}
\begin{remark}
  If $\calV$ is a linear space and $v_1,\dots,v_n \in \calV$, then $\sum_{i=1}^n \alpha_i v_i \in \calV$ for any $\alpha_1, \dots, \alpha_n \in \RR$.
\end{remark}
\begin{definition}[norm]
  Given a linear space $\calV$, a norm is a function $\| \cdot \| : \calV \to \RR$ that satisfies the following three conditions: $\forall w,v \in \calV$ and $\forall \alpha \in \RR$, 
  \begin{enumerate}
  \item absolute scalability: $\| \alpha v \| = |\alpha| \| v \|$
  \item positive definiteness: $ \| v \| \geq 0$,  and $\| v \| = 0 \Leftrightarrow v = 0$
  \item triangle inequality: $  \| w + v \| \leq \| w \| + \| v \| $
  \end{enumerate}
\end{definition}
\begin{definition}[inner product]
  Given a linear space $\calV$, an inner product is a function $(\cdot,\cdot): \calV \times \calV \to \RR$ that satisfies the following three conditions: $\forall w,v,z \in \calV$ and $\forall \alpha,\beta \in \RR$,
\begin{enumerate}
\item symmetry: $(w,v) = (v,w)$
\item linearity in first argument: $ (\alpha w + \beta v, z) = \alpha (w,z) + \beta (v,z)$
\item positive definiteness: $ (v,v) \geq 0$, and $(v,v) = 0 \Leftrightarrow v = 0 $
\end{enumerate}
Note: the combination of the first and second conditions implies that the inner product is also linear in the second argument.
\end{definition}
\begin{definition}[induced norm]
  Given a linear space $\calV$ and an inner product $(\cdot,\cdot): \calV \times \calV \to \RR$, the induced norm $\| \cdot \|$ is given by
  \begin{equation*}
    \| v \| \equiv \sqrt{(v,v)} \quad \forall v \in \calV.
  \end{equation*}
\end{definition}
\begin{remark}[induced norm]
  The induced norm is a norm.
  \begin{proof}
     The absolute scalability follows from linearity:
     \begin{equation*}
       \| \alpha v \|^2 = (\alpha v, \alpha v) = \alpha^2 (v,v) = |\alpha|^2 \| v \|^2.
     \end{equation*}
     The positive definiteness of the induced norm is a direct consequence of the positive definiteness of the associated inner product.  The triangle inequality is proved using the Cauchy-Schwarz inequality in Proposition~\ref{prop:posnd_cauchy_schwarz}: $\forall w,v \in \calV$, 
     \begin{equation*}
       \| w + v \|^2
       = (w + v, w+ v)
       = \| w \|^2 + 2(w,v) + \| v \|^2
       \leq \| w \|^2 + 2 \| w \| \| v \| + \| v \|^2
       =  (\| w \| + \| v \|)^2
     \end{equation*}
     and hence $\| w + v \| \leq \| w \| + \| v \|$.
  \end{proof}
\end{remark}
\begin{proposition}[Cauchy-Schwarz inequality]
  \label{prop:posnd_cauchy_schwarz}
  Given a linear space $\calV$ and an inner product $(\cdot, \cdot): \calV \times \calV \to \RR$, the associated induced norm $\| \cdot \|: \calV \to \RR$ satisfies
  \begin{equation*}
    (w,v) \leq \| w \| \| v \| \quad \forall w ,v \in \calV.
  \end{equation*}
  \begin{proof}
    For $\|v\|=0$, the proof is trivial.  For $\| v \| \neq 0$, we observe
    \begin{equation*}
      0 \leq \left\| w - \frac{(w,v)}{\| v \|^2} v \right\|^2
      = \| w \|^2 - 2 \frac{(w,v)^2}{\| v \|^2} + \frac{(w,v)^2}{\| v \|^2}
      = \| w \|^2 - \frac{(w,v)^2}{\| v \|^2};
    \end{equation*}
    the multiplication by $\| v \|^2$ yields $(w,v)^2 \leq \| w \|^2 \| v \|^2$ or, equivalently, $(w,v) \leq \| w \| \| v \|$.
  \end{proof}
\end{proposition}

We now define a \emph{Hilbert space} and a \emph{Banach space}.
\begin{definition}[Hilbert space]
  A Hilbert space $\calV$ is a complete linear space endowed with an inner product $(\cdot,\cdot): \calV \times \calV \to \RR$ and the associated induced norm $\| \cdot \|: \calV \to \RR$ 
\end{definition}
\begin{definition}[Banach space]
  A Banach space $\calV$ is a complete linear space endowed with a norm $\| \cdot \|: \calV \to \RR$.
\end{definition}
A space $\calV$ is said to be \emph{complete} if any Cauchy sequence with respect to the norm $\| \cdot \|: \calV \to \RR$ converges to an element of $\calV$.  A sequence $v_1$, $v_2$, $v_3$, $\dots$ is said to be a Cauchy sequence if for any $\delta > 0$ there exists a number $N$ such that $\| v_i - v_j \| \leq \delta$, $\forall i,j  > N$.  Moreover, the sequence $v_i$ is said to converge to $v$ if $\| v - v_i \| \to 0$ as $i \to \infty$. The readers unfamiliar with the concept of completeness may think of a Hilbert space and a Banach space simply as an inner product space and a normed space. However, completeness is an important property of the Hilbert and Banach spaces, which makes the spaces suitable for the weak formulation of PDEs.

\section{Sobolev spaces: $L^2(\Omega)$, $H^1(\Omega)$, and $H^1_0(\Omega)$}
\label{sec:posnd_sobolev}
We now introduce some of the Hilbert spaces that are most commonly used in the weak formulation of PDEs. To begin, we characterize the domain $\Omega$ with which the function spaces are associated.
\begin{definition}[Lipschitz domain]
  A domain $\Omega \subset \RR^d$ is called a Lipschitz domain if its boundary $\partial \Omega$ is Lipschitz continuous: corners are permitted, but cusps are not.
\end{definition}
In words, Lipschitz domains are domains with a sufficient regular boundary. We will work exclusively with Lipschitz domains in this lecture.

We now introduce a space of square integrable functions on $\Omega \subset \RR^d$ (in the Lebesgue sense).
\begin{definition}[$L^2(\Omega)$ space]
  The Lebesgue space $L^2(\Omega)$ is endowed with an inner product
  \begin{equation*}
    (w,v)_{L^2(\Omega)} \equiv \int_\Omega w v dx
  \end{equation*}
  and the associated induced norm $\| w \|_{L^2(\Omega)} \equiv \sqrt{(w,w)_{L^2(\Omega)}}$; the space consists of functions
  \begin{equation*}
    L^2(\Omega) \equiv \{ w \ | \ \| w \|_{L^2(\Omega)} < \infty \}.
  \end{equation*}
\end{definition}
The $L^2(\Omega)$ space contains functions that are square integrable over $\Omega$, including functions that are discontinuous and also unbounded.  For example, consider $x^{-1/4}$ over $\Omega \equiv (0,1)$; the function is unbounded at $x = 0$ but is square integrable and hence is in $L^2(\Omega)$.   Two functions in $L^2(\Omega)$ which differ over a set of measure zero --- any points in $\RR^1$, curves in $\RR^2$, and surfaces in $\RR^3$ --- are deemed equivalent. For instance, consider two functions on $\Omega \equiv (-1,1)$,
\begin{equation*}
  f(x) \equiv \begin{cases}
    -1, \quad x \leq 0 \\
    1, \quad x > 0
  \end{cases}
  \qquad \text{and} \qquad
  g(x) \equiv \begin{cases}
    -1, \quad x < 0 \\
    1, \quad x \geq 0
  \end{cases}.
\end{equation*}
These two functions are equivalent in $L^2(\Omega)$.  (We also readily confirm that each function is square integrable.) More formally, the $L^2(\Omega)$ norm of the difference in the two functions is zero; we appeal to the properties of the Lebesgue integration --- we can omit any point (or more generally a set of measure zero) --- to obtain
\begin{equation*}
  \| f - g \|^2_{L^2(\Omega)} \equiv \int_{-1}^1 (f - g)^2 dx =
  \lim_{\epsilon \to 0}
  (\int_{-1}^{-\epsilon} (\underbrace{f - g}_{=0})^2 dx + \int_{\epsilon}^{1} (\underbrace{f - g}_{=0})^2 dx )
  =0.
\end{equation*}
Since $\| f - g \|_{L^2(\Omega)} = 0$,  $f$ and $g$ are equivalent in $L^2(\Omega)$.

\begin{definition}[weak derivative in $\RR^1$]
  Let $\Omega \subset \RR^1$ be a bounded domain and $C^\infty_0(\Omega)$ be the space of infinitely differentiable functions over $\Omega$ that vanish at the endpoints. The weak first derivative of a function $g$, $D^1g$, exists if there exists $D^1g \in L^2(\Omega)$ such that
\begin{equation*}
  \int_\Omega v D^1 g dx = - \int_\Omega \dd{v}{x} g dx \quad \forall v \in C^\infty_0(\Omega).
\end{equation*}
More generally, the weak $k$-th derivative of a function $g$, $D^kg$, exists if there exists $D^kg \in L^2(\Omega)$ such that
\begin{equation*}
  \int_\Omega v D^k g dx = (-1)^k \int_\Omega \dd{^kv}{x^k} g dx \quad \forall v \in C^\infty_0(\Omega).
\end{equation*}
\end{definition}

To make the idea of weak derivative concrete, consider the absolute-value function $g(x) = |x|$ over $\Omega \equiv (-1,1)$.  The function is not differentiable in the classical sense due to the presence of the kink.  However, we can readily show that the weak first derivative of $g$, $D^1g \in L^2(\Omega)$, exists.  We wish to find $D^1 g \in L^2(\Omega)$ such that, $\forall v \in C^\infty_0(\Omega)$, 
\begin{align*}
  \int_{-1}^1 v D^1 g dx
  &=
  - \int_{-1}^1 \dd{v}{x} g dx
  =
  - \lim_{\epsilon \to 0} ( \int_{-1}^{-\epsilon} \dd{v}{x} g dx
  + \int_{\epsilon}^1 \dd{v}{x} g dx )
  \\
  &=
  - \lim_{\epsilon \to 0} (-\int_{-1}^{-\epsilon} v \underbrace{ \dd{g}{x} }_{-1}dx + \underbrace{[vg]_{x=-1}^{-\epsilon}}_{v(-\epsilon)g(-\epsilon)}
  - \int_{\epsilon}^1 v \underbrace{ \dd{g}{x} }_{1} dx + \underbrace{[vg]_{x=\epsilon}^1}_{-v(\epsilon)g(\epsilon)} )
  \\
  &=
   \int_{-1}^{0} -1 v  dx +  \int_{0}^1 1 v dx;  %+ v(-\epsilon) g(-\epsilon) - v(\epsilon) g(\epsilon) )
%  =
% \int_{-1}^1 v H dx
\end{align*}
we observe that 
\begin{equation*}
  (D^1 g)(x) = \begin{cases}
    -1, \quad x \leq 0 \\
    1, \quad x > 0
  \end{cases}
\end{equation*}
satisfies the relationship. (The particular value at $x = 0$ is irrelevant because it is a set of measure zero.) However, the weak second derivative of $g$, $D^2g$, does not exist. To see this, we observe that
\begin{align*}
  \int_{-1}^1 v D^2 g dx
  =
  \int_{-1}^1 \dd{^2v}{x^2} g dx
  =
  \int_{-1}^0 -1 \dd{v}{x} dx + \int_{0}^1 1 \dd{v}{x} dx
  =
  [-v]_{x=-1}^0 + [v]_{x=0}^1
  =
  -2v(0).
\end{align*}
There is no function $D^2g \in L^2(\Omega)$ for which the above relationship holds.  (Note that the Dirac delta is not in $L^2(\Omega)$.)  %From hereon, we interpret any derivative $\dd{v}{x}$ in the weak sense.

%We might conclude that $(D^2 g)(x) = - 2\delta(x)$, where $\delta$ is the Dirac delta, satisfies the relationship; however, the Dirac delta is not integrable and hence is not in $L^2(\Omega)$.

We now generalize the weak derivative to functions in $\RR^d$, $d > 1$.
\begin{definition}[weak derivative in $\RR^d$]
  Let $\Omega \subset \RR^d$ and $C_0^\infty(\Omega)$ be the space of infinitely differentiable functions over $\Omega$ that vanish on the boundary $\partial \Omega$. The weak partial derivative of $g$, $\pp{g}{x_i}$, exists if there exists $\pp{g}{x_i} \in L^2(\Omega)$ such that
  \begin{equation*}
    \int_\Omega v \pp{g}{x_i} dx = - \int_\Omega \pp{v}{x_i} g dx \quad \forall v \in C_0^\infty(\Omega), \quad i = 1,\dots, d.
  \end{equation*}
  The associated gradient is $\nabla v \equiv (\pp{v}{x_1}, \dots, \pp{v}{x_d}) \in (L^2(\Omega))^d$.
\end{definition}
Having defined the weak derivative, we now define the $H^1(\Omega)$ space:
\begin{definition}[$H^1(\Omega)$ space]
  The Sobolev space $H^1(\Omega)$ is endowed with an inner product
  \begin{equation*}
    (w,v)_{H^1(\Omega)} \equiv \int_{\Omega} (\nabla v \cdot \nabla w + v w) dx
    = (\nabla v, \nabla w)_{L^2(\Omega)} + (v,w)_{L^2(\Omega)},
  \end{equation*}
  and the associated induced norm $\| w \|_{H^1(\Omega)} \equiv \sqrt{(w,w)_{H^1(\Omega)}}$; the space consists of functions
  \begin{equation*}
    H^1(\Omega) \equiv \{ w \ | \ \| w \|_{H^1(\Omega)} < \infty \}.
  \end{equation*}
\end{definition}
In words, the $H^1(\Omega)$ space consists of functions that are square integrable and whose weak first derivative is square integrable (i.e., the weak first derivative is in $L^2(\Omega)$).    For instance, the absolute-value function $g(x) = |x|$ on $\Omega \equiv (-1,1)$ is in $H^1(\Omega)$ because the function is square integrable and its weak derivative --- which is a Heaviside-like function as shown earlier --- is square integrable. On the other hand, the Heaviside-like function is not in $H^1(\Omega)$ because its weak first derivative does not exist. In general, $H^1(\Omega) \subset L^2(\Omega)$ because $H^1(\Omega)$ functions must have a square-integrable weak first derivative whereas $L^2(\Omega)$ functions do not.

Another related space that is frequently encountered in the weak formulation of PDEs is the $H^1_0(\Omega)$ space.
\begin{definition}[$H^1_0(\Omega)$ space] The $H^1_0(\Omega)$ is endowed with the $H^1(\Omega)$ inner product $(w,v)_{H^1(\Omega)} \equiv \int_\Omega (\nabla v \cdot \nabla w + v w) dx$ and consists of functions
\begin{equation*}
  H^1_0(\Omega) \equiv \{ w \in H^1(\Omega) \ | \ w|_{\partial \Omega} = 0 \},
\end{equation*}
where $\partial \Omega$ denotes the boundary of $\Omega$.
\end{definition}
The $H^1_0(\Omega)$ space consists of a subset of $H^1(\Omega)$ functions that vanish on the boundary.  Note that $H^1_0(\Omega)$ for $\Omega \equiv (0,1) \subset \RR^1$ is precisely the space $\calV$ we used in Sections~\eqref{sec:pos1d_var}~and~\eqref{sec:pos1d_min} for the variational and minimization formulations, respectively, of the one-dimensional Poisson equation with the homogeneous Dirichlet boundary conditions.  By construction $H^1_0(\Omega) \subset H^1(\Omega)$ since the $H^1(\Omega)$ space contains functions that do not vanish on the boundary.

We also introduce the $H^1(\Omega)$ \emph{semi-norm}:
\begin{definition}[$H^1(\Omega)$ semi-norm]
  The $H^1(\Omega)$ semi-norm is denoted by $| \cdot |_{H^1(\Omega)}$ and is given by
  \begin{equation*}
    | v |_{H^1(\Omega)} \equiv \left(\int_{\Omega} \nabla v \cdot \nabla v dx \right)^{1/2} = \| \nabla v \|_{L^2(\Omega)}   \quad \forall v \in H^1(\Omega).
  \end{equation*}  
\end{definition}
%\begin{remark}
  The $H^1(\Omega)$ semi-norm is not a norm on $H^1(\Omega)$.  Specifically, a semi-norm in general does not satisfy the positive definiteness condition.  For example, consider a function $v = 1$ on $\Omega \equiv (-1,1)$; the function is clearly not zero, but $|v|_{H^1(\Omega)} = \int_\Omega (\dd{v}{x})^2 dx = \int_\Omega 0 dx = 0$.
%\end{remark}

\section{Sobolev spaces: more general spaces}
While we most frequently use Sobolev spaces $L^2(\Omega)$, $H^1(\Omega)$, and $H^1_0(\Omega)$ in weak formulations of second-order PDEs, more general Sobolev spaces are required for higher-order PDEs.  We here introduce these more general spaces for completeness.  As the results below can be considered a generalization of the particular results in Section~\ref{sec:posnd_sobolev}, we will simply state them.
\begin{definition}[multi-dimensional derivative]
  Let $\alpha \equiv (\alpha_1, \dots, \alpha_d)$ be a $d$-dimensional multi-index of non-negative integers, and define its absolute value by $|\alpha| \equiv \alpha_1 + \cdots + \alpha_d$. The partial derivative operator $D^\alpha$ is given by 
  \begin{equation*}
    D^\alpha (\cdot)  \equiv \pp{^{|\alpha|} (\cdot)}{x_1^{\alpha_1}  \cdots \partial x_d^{\alpha_d}}.
  \end{equation*}
\end{definition}
\begin{definition}[$H^k(\Omega)$ space]
  For a non-negative integer $k$, the Sobolev space $H^k(\Omega)$ is endowed with an inner product
  \begin{equation*}
    (w,v)_{H^k(\Omega)} \equiv \sum_{|\alpha| \leq k} (D^\alpha w, D^\alpha v)_{L^2(\Omega)}
  \end{equation*}
  and the associated induced norm $\| w \|_{H^k(\Omega)} \equiv \sqrt{(w,w)_{H^k(\Omega)}}$; the space consists of functions
  \begin{equation*}
    H^k(\Omega) \equiv \{ w \ | \ \| w \|_{H^k(\Omega)} < \infty \}.
  \end{equation*}
\end{definition} 
\begin{definition}[$H^k(\Omega)$ semi-norm]
  The $H^k(\Omega)$ semi-norm is denoted by $| \cdot |_{H^k(\Omega)}$ and is given by
  \begin{equation*}
    | v |_{H^k(\Omega)} \equiv \| D^\alpha v \|_{L^2(\Omega)} \quad \forall v \in H^k(\Omega).
  \end{equation*}  
\end{definition}
%We finally introduce more general Banach spaces $L^p(\Omega)$ and $W^{k,p}(\Omega)$ for completeness.
\begin{definition}[$L^p(\Omega)$ space]
  The Banach space $L^p(\Omega)$ is endowed with a norm
  \begin{equation*}
    \| w \|_{L^p(\Omega)} \equiv \left(\int_\Omega |w|^p dx\right)^{1/p}
  \end{equation*}
  in the case $1 \geq p < \infty$ and
  \begin{equation*}
    \| w \|_{L^\infty(\Omega)} \equiv \esssup_{x \in \Omega} | w(x) | 
  \end{equation*}
  in the case $p = \infty$.   In either case, the $L^p(\Omega)$ space consists of functions
  \begin{equation*}
    L^p(\Omega) \equiv \{ w \ | \ \| w \|_{L^p(\Omega)} < \infty \}.
  \end{equation*}
\end{definition}
\begin{definition}[$W^k_p$ space]
  The Sobolev space $W^k_p$ is endowed with a norm
  \begin{equation*}
    \| w \|_{W^k_p(\Omega)} \equiv \left( \sum_{|\alpha|\leq k} \| D^\alpha w \|^p_{L^p(\Omega)} \right)^{1/p}
  \end{equation*}
  in the case $1 \geq p < \infty$ and
  \begin{equation*}
    \| w \|_{W^k_\infty(\Omega)} \equiv \max_{|\alpha| \leq k} \| D^\alpha w \|_{L^\infty(\Omega)}
  \end{equation*}
  in the case $p = \infty$. In either case, the $W^k_p(\Omega)$ space consists of functions
  \begin{equation*}
    W^k_p(\Omega) = \{ w \ | \| w \|_{W^k_p(\Omega)} < \infty \}.
  \end{equation*}
\end{definition}
\begin{remark}
  The $H^k(\Omega)$ space is a special case of $W^k_p(\Omega)$ space for $p = 2$.
\end{remark}

%It may be difficult to appreciate the formalism provided in this section at this point.  But, we introduce these spaces upfront such that we can state our weak formulation in a proper functional setting.  We will later see that this formalism allows us to provide various theoretical results on the weak formulation and the associated finite element approximation, which is the strength of the finite element method.



\section{$d$-dimensional Poisson problem: homogeneous Dirichlet BC}
\label{sec:posnd_homo_dir}
We consider a Poisson equation in $\RR^d$ for $d \geq 1$.  To this end, we first introduce a $d$-dimensional Lipschitz domain $\Omega \subset \RR^d$. The strong form of the Poisson equation with homogeneous Dirichlet boundary conditions is as follows: find $u$ such that
\begin{align}
  - \Delta u &= f \quad \text{in } \Omega \label{eq:posnd_strong} \\
  u &= 0 \quad \text{on } \partial \Omega \notag.
\end{align}
 Here, the Laplacian operator $\Delta$ satisfies $\Delta w \equiv \pp{^2w}{x^2_1} + \cdots + \pp{^2w}{x^2_d}$ for any $w$.  The Poisson equation models, for instance, steady heat transfer, where $u$ is the temperature field (relative to the ambient temperature), $f$ is the volume heat source, and the homogeneous Dirichlet boundary condition corresponds to the fixed-temperature condition.

The variational formulation of~\eqref{eq:posnd_strong} requires an appropriate choice of a function space.  For homogeneous Dirichlet boundary condition, the appropriate Sobolev space is
\begin{equation*}
  \calV \equiv H^1_0(\Omega).
\end{equation*}
We recall that $H^1_0(\Omega) \equiv \{ w \in H^1(\Omega) \ | \ w|_{\partial \Omega} = 0 \}$; i.e., the space consists of functions (i) whose value and first derivative are square integrable and (ii) that vanish on the boundary.  Note that any function $w \in H^1_0(\Omega)$ satisfies the boundary condition $u|_{\partial \Omega} = 0$ by construction.

To obtain a variational (or weak) form, we employ the weighted residual method: we multiply~\eqref{eq:posnd_strong} by a test function $v \in \calV$, integrate the expression, and then integrate by parts the left hand side:
\begin{equation*}
  \int_\Omega v (-\Delta u) dx = \int_\Omega v f dx \quad \Rightarrow \quad
  \int_\Omega \nabla v \cdot \nabla u dx - \underbrace{ \int_{\partial \Omega} v \pp{u}{n} ds}_{ = 0}  = \int_\Omega v f dx;
\end{equation*}
the boundary term vanishes because $v|_{\partial \Omega} = 0$ for $v \in \calV \equiv H^1_0(\Omega)$.  We now recognize the bilinear form $a: \calV \times \calV \to \RR$,
\begin{equation*}
  a(w,v) \equiv \int_\Omega \nabla v \cdot \nabla w dx \quad \forall w,v \in \calV,
\end{equation*}
and the linear form $\ell: \calV \to \RR$,
\begin{equation*}
  \ell(v) \equiv \int_\Omega v f dx \quad \forall v \in \calV.
\end{equation*}
Our variational problem is as follows: find $u \in \calV$ such that
\begin{equation}
  a(u,v) = \ell(v) \quad \forall v \in \calV. \label{eq:posnd_weak}
\end{equation}
 Using exactly the same procedure as the one-dimensional case shown in Section~\ref{sec:pos1d_var}, we can show that the solution to the strong form~\eqref{eq:posnd_strong} satisfies the variational form~\eqref{eq:posnd_weak}.  However the converse is not true in general; the variational form admits more general loads $f$ and hence solutions than the strong form.

%% For Poisson equation, which has an intrinsic energy, we can also provide a minimization form.  To this end, we introduce a functional $J: \calV \to \RR$ given by
%% \begin{equation*}
%%   J(w) \equiv \frac{1}{2} \int_\Omega \nabla w \cdot \nabla w dx - \int_\Omega f s dx \quad \forall w \in \calV.
%% \end{equation*}
%% Our minimization problem is as follows: find $u \in \calV$ such that
%% \begin{equation}
%%   u = \argmin_{w \in \calV} J(w). \label{eq:posnd_min}
%% \end{equation}
%% Again, using the same procedure as the one-dimensional case, we can show that $u \in \calV$ is the solution to the variational form~\eqref{eq:posnd_weak} if and only if it is the solution to the minimization form~\eqref{eq:posnd_min}.

\section{Mixed problems: essential and natural boundary conditions}
\label{sec:posnd_mixed}
We have so far considered Poisson equations with a homogeneous Dirichlet boundary condition.  We now consider a problem with a mixed boundary condition. To this end, given $\Omega \subset \RR^d$, we first partition the domain boundary $\partial \Omega$ into a Dirichlet part $\Gamma_D$ and a Neumann part $\Gamma_N$ such that $\overline{\partial \Omega} = \overline \Gamma_D \cup \overline \Gamma_N$ and $\Gamma_N \neq \emptyset$.  We then consider the following boundary value problem: find $u$ such that
\begin{align}
  -\Delta u &= f \quad \text{in } \Omega \notag \\
  u &= 0 \quad \text{on } \Gamma_D \label{eq:posnd_mixed_bc_strong} \\
  \pp{u}{n} &= g \quad \text{on } \Gamma_N, \notag
\end{align}
where $f$ is the volume source term and $g$ is the boundary source term.  In the case of a steady heat transfer, $f$ and $g$ represent volume and boundary heat sources, respectively.

To obtain a variational form of~\eqref{eq:posnd_mixed_bc_strong},  we redefine the function space relative to the homogeneous Dirichlet boundary condition case.  The function space suitable for the mixed boundary condition case is
\begin{equation}
  \calV \equiv \{ v \in H^1(\Omega) \ | \ v|_{\Gamma_D} = 0 \}.
  \label{eq:posnd_mixed_bc_space}
\end{equation}
Note that $H^1_0(\Omega) \subset \calV \subset H^1(\Omega)$; functions in $H^1_0(\Omega)$ must vanish everywhere on $\partial \Omega$, functions in $\calV$ must vanish only on $\Gamma_D \subset \partial \Omega$, and functions in $H^1(\Omega)$ have no conditions on their boundary values. We now apply the weighted residual method to obtain the variational form: we multiply \eqref{eq:posnd_mixed_bc_strong} by a test function $v \in \calV$, integrate the expression, and then integrate by parts the left hand side:
\begin{equation*}
  \int_\Omega v (-\Delta u) dx = \int_\Omega v f dx
  \quad \Rightarrow \quad
  \int_\Omega \nabla v \cdot \nabla u dx
  - \underbrace{\int_{\Gamma_D} v \pp{u}{n} ds}_{= 0}
  - \int_{\Gamma_N} v \pp{u}{n} ds
  =
  \int_{\Omega} v f dx;
\end{equation*}
the boundary term on $\Gamma_D$ vanishes because $v|_{\Gamma_D} = 0$ for $v \in \calV$. On the other hand, the boundary term on $\Gamma_N$ remains; we now replace $\pp{u}{n}$ with $g$ to incorporate the boundary condition we wish to impose: $\pp{u}{n} = g$ on $\Gamma_N$. The resulting weighted residual form is
\begin{equation*}
  \int_\Omega \nabla v \cdot \nabla u dx
  =
  \int_{\Omega} v f dx
  + \int_{\Gamma_N} v g ds.
\end{equation*}
We now recognize the bilinear form $a: \calV \times \calV \to \RR$ given by
\begin{equation*}
  a(w,v) \equiv \int_\Omega \nabla v \cdot \nabla w dx \quad \forall w,v \in \calV,
\end{equation*}
and the linear form $\ell: \calV \to \RR$ given by
\begin{equation*}
  \ell(v) \equiv \int_\Omega v f dx + \int_{\Gamma_N} v g ds \quad \forall v \in \calV.
\end{equation*}
Our variational problem is as follows: find $u \in \calV$ such that
\begin{equation}
  a(u,v) = \ell(v) \quad \forall v \in \calV. \label{eq:posnd_mixed_bc_weak}
\end{equation}

We readily observe that the solution to the strong form~\eqref{eq:posnd_mixed_bc_strong} satisfies the variational form~\eqref{eq:posnd_mixed_bc_weak};  for all $v \in \calV$,
\begin{align*}
  a(u,v) - \ell(v)
  &\equiv \int_\Omega \nabla v \cdot \nabla u dx - \int_\Omega vf dx - \int_{\Gamma_N} vg ds
  \\
  &= \int_\Omega v (-\Delta u) dx + \int_{\Gamma_D} v \pp{u}{n} ds + \int_{\Gamma_N} v \pp{u}{n} ds  - \int_\Omega vf dx - \int_{\Gamma_N} vg ds
  \\
  &= \int_\Omega v \underbrace{ (-\Delta u - f) }_{= 0 \text{ as $-\Delta u=  f$ in $\Omega$}} dx
  + \underbrace{ \int_{\Gamma_D} v \pp{u}{n} ds }_{= 0 \text{ as $v|_{\Gamma_D} = 0$}}
  + \int_{\Gamma_N} v \underbrace{ \left( \pp{u}{n} - g \right) }_{= 0 \text{ as $\pp{u}{n} = g$ on $\Gamma_N$}}ds = 0.
\end{align*}
Hence a solution to the strong form~\eqref{eq:posnd_mixed_bc_strong} is a solution to the variational form~\eqref{eq:posnd_mixed_bc_weak}; however, again the converse is not true as the variational form admits more general forms of $f$ and $g$ than the strong form.

In the variational formulation of the mixed boundary condition, the Dirichlet and Neumann conditions are treated differently.  On one hand, we explicitly impose the Dirichlet boundary condition $u = 0$ on $\Gamma_D$ through the choice of the space $\calV$ in~\eqref{eq:posnd_mixed_bc_space}. On the other hand, the Neumann boundary condition $\pp{u}{n} = g$ on $\Gamma_N$ is implicitly contained in the variational statement~\eqref{eq:posnd_mixed_bc_weak}.  A boundary condition that is explicitly imposed by the choice of the function space is called an \emph{essential boundary condition}; a boundary condition that is implicitly imposed by the variational statement is called a \emph{natural boundary condition}.  In the above treatment of the Poisson equation with a mixed boundary condition, the Dirichlet condition is an essential boundary condition, and the Neumann condition is a natural boundary condition.



%% We can similarly consider a minimization form of~\eqref{eq:posnd_mixed_bc_strong}.  We again work with the space $\calV \equiv \{ v \in H^1(\Omega) \ | \ v|_{\Gamma_D} = 0 \}$.  We then introduce a functional $J: \calV \to \RR$ given by
%% \begin{equation}
%%   J(w) \equiv \frac{1}{2} \int_\Omega \nabla w \cdot \nabla w dx - \int_\Omega f w dx - \int_{\Gamma_N} g w ds \quad \forall w \in \calV;
%%   \label{eq:posnd_mixed_bc_min_func}
%% \end{equation}
%% note the addition of the term on $\Gamma_N$.
%% Our minimization problem is as follows: find $u \in \calV$ such that
%% \begin{equation}
%%   u = \argmin_{w \in \calV} J(w). \label{eq:posnd_mixed_bc_min}
%% \end{equation}
%% We can readily show, using the same procedure used in Section~\ref{sec:pos1d_min}, that $u \in \calV$ is the solution to the variational problem~\eqref{eq:posnd_mixed_bc_weak} if and only if it is the solution to the minimization problem~\eqref{eq:posnd_mixed_bc_min}.

%% We can readily show that the solution to the strong form~\eqref{eq:posnd_mixed_bc_strong} satisfies the minimization condition~\eqref{eq:posnd_mixed_bc_min}. To see this, let $w = u + v$, where $u \in \calV$ is the solution to~\eqref{eq:posnd_mixed_bc_strong} and $v$ is an arbitrary function in $\calV$. We  then observe
%% \begin{align*}
%%   J(u + v)
%%   &=
%%   \frac{1}{2} \int_\Omega \nabla (u + v) \cdot \nabla (u+v) dx - \int_\Omega f (u+v) dx - \int_{\Gamma_N} g (u + v) ds
%%   \\
%%   &= \underbrace{ \frac{1}{2} \int_\Omega \nabla u \cdot \nabla u dx - \int_\Omega fu dx - \int_{\Gamma_N} g u ds }_{J(u)}
%%   \\
%%   &\quad + \underbrace{\int_{\Omega} \nabla v \cdot \nabla u dx - \int_\Omega f v - \int_{\Gamma_N} g v ds}_{J'(u;v) \text{ --- first variation}}
%%   + \underbrace{  \frac{1}{2} \int_{\Omega} \nabla v \cdot \nabla v dx }_{> 0 \text{ for } v \neq 0}.
%% \end{align*}
%% We integrate by parts the first term of $J'(u;v)$ to obtain
%% \begin{align*}
%%   J'(u;v) &= \int_{\Omega} \nabla v \cdot \nabla u dx - \int_\Omega f v dx - \int_{\Gamma_N} g v ds
%%   \\
%%   &= - \int_\Omega v (\underbrace{ \Delta u + f }_{= 0 \text{ as } -\Delta u = f \text{ in } \Omega}) dx + \int_{\Gamma_D} \underbrace{ v \pp{u}{n} }_{=0 \text{ as } v \in \calV}ds + \int_{\Gamma_N}  v (\underbrace{ \pp{u}{n} - g }_{= 0 \text{ as } \pp{u}{n} = g \text{ on } \Gamma_N}) ds = 0;
%% \end{align*}
%% if $u$ is the solution to the strong form~\eqref{eq:posnd_mixed_bc_strong}, then $J'(u;v) = 0$ for all $v \in \calV$. It follows
%% \begin{equation*}
%%   J(u+v) = J(u) + \frac{1}{2} \int_\Omega \nabla v \cdot \nabla v dx > J(u) \quad \forall v \neq 0,
%% \end{equation*}
%% and hence the solution $u$ to strong form~\eqref{eq:posnd_mixed_bc_strong} is the minimizer of the energy functional~\eqref{eq:posnd_mixed_bc_min_func} and hence the solution to the minimization form~\eqref{eq:posnd_mixed_bc_min}.


\section{Inhomogeneous Dirichlet boundary condition}
\label{sec:posnd_inhomo_bc}
We now consider a problem with \emph{inhomogeneous} Dirichlet boundary condition.  The strong form is as follows: find $u$ such that
\begin{align}
  -\Delta u &= f \quad \text{in } \Omega \label{eq:posnd_inhomo_bc_strong} \\
  u &= u^B \quad \text{on } \Gamma_D \equiv \partial \Omega \notag
\end{align}
for some boundary function $u^B$ and source term $f$. While we here focus on the pure Dirichlet problem for simplicity, the approach in this section can be combined with the approach for mixed problems in Section~\ref{sec:posnd_mixed} to treat mixed problems with inhomogeneous Dirichlet and Neumann boundary conditions.

To obtain a variational form of~\eqref{eq:posnd_inhomo_bc_strong}, we introduce spaces
\begin{align*}
  \calV^E &\equiv \{ w \in H^1(\Omega) \ | \ w|_{\Gamma_D} = u^B \}, \\
  \calV &\equiv H^1_0(\Omega).
\end{align*}
The superscript ``E'' stands for ``essential'', as the space $\calV^E$ satisfies the essential (i.e., Dirichlet) boundary condition. Note that, for $u^B \neq 0$, $\calV^E$ is \emph{not} a linear space; for $w,v \in \calV^E$, $z = w + v \notin \calV^E$ because $z|_{\Gamma_D} = 2 u^B \neq u^B$. Rather, $\calV^E$ is an \emph{affine space}: given an arbitrary fixed element $u^E \in \calV^E$ so that $u^E|_{\Gamma_D} = u^B$, we have $\calV^E = u^E + \calV = \{ u^E + v \ | \ v \in \calV \}$. We now employ the weighted residual method: we multiply~\eqref{eq:posnd_inhomo_bc_strong} by a test function $v$ in the \emph{linear space} $\calV$ --- and not \emph{affine space} $\calV^E$ ---, integrate the expression, and integrate by parts the right hand side to obtain
\begin{equation*}
  \int_{\Omega} v(-\Delta u) dx = \int_\Omega vf dx
  \quad \Rightarrow \quad
  \int_\Omega \nabla v \cdot \nabla u dx - \underbrace{ \int_{\partial \Omega} v \pp{u}{n} ds }_{= 0}
  = \int_\Omega v f dx;
\end{equation*}
again the boundary term vanishes because $v$ is in $\calV$ (and not $\calV^E$). 
We recognize a bilinear form and a linear form
\begin{align*}
  a(w,v) &\equiv \int_\Omega \nabla v \cdot \nabla w dx \quad \forall w,v \in \calV \\
  \ell(v) &\equiv \int_\Omega vf dx \quad \forall v \in \calV.
\end{align*}
The variational problem is as follows: find $u \in \calV^E$ such that
\begin{equation}
  a(u,v) = \ell(v) \quad \forall v \in \calV.
  \label{eq:posnd_inhomo_bc_var}
\end{equation}
We note that the bilinear form and linear form are identical to the homogeneous Dirichlet boundary condition case considered in Section~\ref{sec:posnd_homo_dir}.  However, our trial space is different; the space $\calV^E$ is an affine space of functions that satisfy the inhomogeneous Dirichlet boundary condition.  As discussed in Section~\ref{sec:posnd_mixed}, a Dirichlet boundary condition is an essential boundary condition, which is explicitly imposed through the choice of the space. %ecause the inhomogeneous Dirichlet boundary condition $u = u^B$ on $\Gamma_D$ is an essential boundary condition. the test space $\calV$ is a linear space of functions that vanish on the Dirichlet boundary.

We readily observe that the solution to the strong form~\eqref{eq:posnd_inhomo_bc_strong} satisfies the variational form~\eqref{eq:posnd_inhomo_bc_var};  for all $v \in \calV$,
\begin{align*}
  a(u,v) - \ell(v)
  &\equiv \int_\Omega \nabla v \cdot \nabla u dx - \int_\Omega vf dx - \int_{\Gamma_N} vg ds
  \\
  &= \int_\Omega v (-\Delta u) dx + \int_{\partial \Omega} v \pp{u}{n} ds  - \int_\Omega vf dx 
  \\
  &= \int_\Omega v \underbrace{ (-\Delta u - f) }_{= 0 \text{ as $-\Delta u=  0$ in $\Omega$}} dx
  + \underbrace{ \int_{\partial \Omega} v \pp{u}{n} ds }_{= 0 \text{ as $v|_{\Gamma_D \equiv \partial \Omega} = 0$}}.
\end{align*}
Moreover, the boundary condition $u = u^B$ on $\Gamma_D \equiv \partial \Omega$ is satisfied because $u \in \calV^E$. 
Hence a solution to the strong form~\eqref{eq:posnd_inhomo_bc_strong} is a solution to the variational form~\eqref{eq:posnd_inhomo_bc_var}; however, again the converse is not true as the variational form admits more general solutions.

In practice, it is more convenient to reformulate the problem such that both the trial and test spaces are linear.  We first choose an arbitrary fixed function $u^E$ in $\calV^E$; the function $u^E \in \calV^E$ can be any function in $H^1(\Omega)$ that satisfies the inhomogeneous Dirichlet boundary condition so that $u^E|_{\Gamma_D} = u^B$. We then express the solution $u$ as $u = u^E + \tilde u$ for $\tilde u$ in the linear space $\calV$, and rearrange the variational form~\eqref{eq:posnd_inhomo_bc_var} as
\begin{equation*}
  a(u^E + \tilde u,v) = \ell(v) \quad \Rightarrow \quad
  a(\tilde u,v) = \ell(v) - a(u^E,v).
\end{equation*}
We now recognize the right hand side $\ell(\cdot) - a(u^E,\cdot)$ as another linear form on $\calV$ and formally introduce $\tilde \ell: \calV \to \RR$ such that
\begin{equation*}
  \tilde \ell(v) \equiv \ell(v) - a(u^E,v) \quad \forall v \in \calV.
\end{equation*}
We then consider a variational problem for $\tilde u$: find $\tilde u \in \calV$ such that
\begin{equation}
  \label{eq:posnd_inhomo_bc_var_reform}
  a(\tilde u,v) = \tilde \ell(v) \quad \forall v \in \calV.
\end{equation}
Once we find $\tilde u$, we then set $u = u^E + \tilde u$, which is in $\calV^E$. Note that $\tilde u \in \calV$ depends on our choice of $u^E \in \calV^E$ because $\tilde \ell(\cdot)$ depends on $u^E$; however, the actual solution $u = u^E + \tilde u$ is independent of the particular choice of $u^E \in \calV^E$.

%% For completeness, we also introduce the minimization form.  We introduce a functional $J: \calV^E \to \RR$ given by
%% \begin{equation}
%%   J(w) \equiv \frac{1}{2} \int_{\Omega} \nabla w \cdot \nabla w dx - \int_\Omega f w dx
%%   \label{eq:posnd_inhomo_bc_min_func}
%% \end{equation}
%% and state the minimization problem: find $u \in \calV^E$ such that
%% \begin{equation}
%%   u = \argmin_{w \in \calV^E} J(w).
%%   \label{eq:posnd_inhomo_bc_min}
%% \end{equation}
%% We can readily show, using the same procedure used in Section~\ref{sec:pos1d_min}, that $u \in \calV^E$ is the solution to the variational problem~\eqref{eq:posnd_inhomo_bc_var} if and only if it is the solution to the minimization problem~\eqref{eq:posnd_inhomo_bc_min}.

%% We now show that the solution to~\eqref{eq:posnd_inhomo_bc_strong} satisfies the minimization statement~\eqref{eq:posnd_inhomo_bc_min}. We first set $w = u + v$, where $u \in \calV^E$ is the solution to~\eqref{eq:posnd_inhomo_bc_strong} and $v$ is an arbitrary function in $\calV$ (and \emph{not} $\calV^E$). We then observe
%% \begin{align*}
%%   J(u + v)
%%   &=
%%   \frac{1}{2} \int_\Omega \nabla (u + v) \cdot \nabla (u+v) dx - \int_\Omega f (u+v) dx 
%%   \\
%%   &= \underbrace{ \frac{1}{2} \int_\Omega \nabla u \cdot \nabla u dx - \int_\Omega fu dx }_{J(u)}
%%   + \underbrace{\int_{\Omega} \nabla v \cdot \nabla u dx - \int_\Omega f v }_{J'(u;v) \text{ --- first variation}}
%%   + \underbrace{  \frac{1}{2} \int_{\Omega} \nabla v \cdot \nabla v dx }_{> 0 \text{ for } v \neq 0}.
%% \end{align*}
%% We integrate by parts the first term of $J'(u;v)$ to obtain
%% \begin{equation*}
%%   J'(u;v) = \int_{\Omega} \nabla v \cdot \nabla u dx - \int_\Omega f v
%%   = - \int_\Omega v (\underbrace{ \Delta u + f }_{= 0 \text{ as } -\Delta u = f \text{ in } \Omega}) dx + \int_{\Gamma_D \equiv \partial \Omega} \underbrace{ v \pp{u}{n} }_{=0 \text{ as } v \in \calV}ds  = 0;
%% \end{equation*}
%% the second term vanishes because $v \in \calV$ (and not $\calV^E$). It follows
%% \begin{equation*}
%%   J(u+v) = J(u) + \frac{1}{2} \int_\Omega \nabla v \cdot \nabla v dx > J(u) \quad \forall v \neq 0,
%% \end{equation*}
%% and hence the solution $u$ to strong form~\eqref{eq:posnd_mixed_bc_strong} is the minimizer of the functional~\eqref{eq:posnd_mixed_bc_min_func} and hence the solution to the minimization form~\eqref{eq:posnd_mixed_bc_min}.


%The solution is sought in the space $\calV^E$ that satisfies the inhomogeneous Dirichlet boundary condition, while the test functions are in the space $\calV$.



\section{General second-order elliptic equation}
We have so far considered the variational formulation of Poisson equations with various boundary conditions. We can readily extend our approach to treat general second-order elliptic equations. To demonstrate the idea, we consider a convection-reaction-diffusion equation with (inhomogeneous) Dirichlet, Neumann, and Robin boundary conditions. To this end, we partition the Lipschitz domain $\Omega \subset \RR^d$ into the Dirichlet boundary $\Gamma_D$, the Neuamnn boundary $\Gamma_N$, and the Robin boundary $\Gamma_R$ such that $\overline{\partial \Omega} = \overline{\Gamma}_D \cup \overline{\Gamma}_N \cup \overline{\Gamma}_R$; we assume $\Gamma_D \cup \Gamma_R \neq \emptyset$. We then consider a problem of the following form: find $u$ such that
\begin{align}
  - \nabla \cdot (a \nabla u) + b \cdot \nabla u + c u &= f \quad \text{in } \Omega
  \notag \\
  u &= u^B \quad \text{on } \Gamma_D \label{eq:posnd_gen_strong} \\
  n \cdot a \nabla u &= g \quad \text{on } \Gamma_N \notag \\
  n \cdot a \nabla u + k u &= q \quad \text{on } \Gamma_R, \notag
\end{align}
where $a: \Omega \to \RR^{d \times d}$ is the diffusivity tensor, $b: \Omega \to \RR^d$ is the advection vector, $c: \Omega \to \RR$ is the reaction constant, $f: \Omega \to \RR$ is the source term,  $n: \partial \Omega \to \RR^d$ is the outward-point normal on $\partial \Omega$, $u^B: \Gamma_D \to \RR$ is the Dirichlet boundary function, $g: \Gamma_N \to \RR$ is the Neumann source term, $k: \Gamma_R \to \RR$ is the Robin coefficient, and $q: \Gamma_R \to \RR$ is the Robin source term.  Note that in general each coefficient is spatially varying and hence is a function of space; e.g., the diffusivity tensor evaluated at $x \in \Omega \subset \RR^d$ is in $\RR^{d \times d}$ and hence is denoted $a: \Omega \to \RR^{d \times d}$.  For the second-order PDE to be \emph{elliptic}, we require that the diffusitivity tensor is symmetric positive definite almost everywhere: $a(x) \in \RR^{d \times d}$ satisfies
\begin{equation*}
  \xi^T a(x) \xi > 0 \quad \forall \xi \neq 0 \quad \text{ a.e. in } \Omega.
%  \sum_{i,j=1}^d a_{ij}(x) \xi_i \xi_j > 0 \quad \forall \xi \in \RR^d \text{ a.e. in } \Omega.
\end{equation*}
Also note that in order for the differentiation $\nabla \cdot ( a \nabla u)$ for the \emph{strong formulation} \eqref{eq:posnd_gen_strong} to be well defined, the diffusivity tensor field must satisfy certain smoothness conditions; we will soon see that this is not a requirement for the weak formulation.

To obtain a variational form of~\eqref{eq:posnd_gen_strong}, we introduce spaces
\begin{align*}
  \calV^E &\equiv \{ w \in H^1(\Omega) \ | \ w|_{\Gamma_D} = u^B \}, \\
  \calV &\equiv \{ w \in H^1(\Omega) \ | \ w_{\Gamma_D} = 0 \}.
\end{align*}
As discussed in Section~\ref{sec:posnd_inhomo_bc}, the Dirichlet boundary condition is imposed strongly; the Neumann and Robin boundary conditions are imposed weakly.  We now multiply~\eqref{eq:posnd_gen_strong} by a test function $v$ in the linear space $\calV$, integrate the expression, and integrate by parts the diffusion term to obtain
\begin{align*}
  &\int_\Omega v (- \nabla \cdot a \nabla u + b \cdot \nabla u + c u - f) dx = 0 \\
  & \Rightarrow
  \int_\Omega (\nabla v \cdot a \nabla u  + v b \cdot \nabla u + c vu -vf ) dx
  -  \underbrace{\int_{\Gamma_D} v n \cdot a \nabla u ds}_{\text{(D)}}
  - \underbrace{\int_{\Gamma_N} v n \cdot a \nabla u ds}_{\text{(N)}}
  - \underbrace{\int_{\Gamma_R} v n \cdot a \nabla u ds}_{\text{(R)}}
\end{align*}
We now impose the boundary conditions.  The Dirichlet boundary condition is imposed strongly by the choice of the trial space $\calV^E$ and the test space $\calV$; the term (D) vanishes because $v|_{\Gamma_D} = 0$ for all $v \in \calV$.  The Neumann boundary condition $n \cdot a \nabla u = g$ is weakly imposed; we replace the boundary term (N) by $\int_{\Gamma_N} v g ds$.  The Robin boundary condition $\pp{u}{n} + k u = q$ is also weakly imposed; we replace the boundary term (R) by $\int_{\Gamma_R} v (-ku + q) ds$.  Upon the substitution of the appropriate boundary conditions, our weighted-residual formulation reads as follows: find $u \in \calV^E$ such that
\begin{equation*}
  \int_\Omega (\nabla v \cdot a \nabla u  + v b \cdot \nabla u + c vu - vf) dx
  - \int_{\Gamma_N} v g ds - \int_{\Gamma_R} v (-ku + q) ds = 0
  \quad \forall v \in \calV.
\end{equation*}
Some reorganization of the terms yield the following variational formulation: find $u \in \calV^E$ such that
\begin{equation}
  a(u,v) = \ell(v) \quad \forall v \in \calV,
  \label{eq:posnd_gen_weak}
\end{equation}
where
\begin{align*}
  a(w,v) &\equiv \int_\Omega (\nabla v \cdot a \nabla w + v b \cdot \nabla u + c vu ) dx + \int_{\Gamma_R} k vw ds \quad \forall w, v \in \calV \\
  \ell(v) &\equiv \int_\Omega fv dx + \int_{\Gamma_N} gv ds + \int_{\Gamma_R} qv ds.
  \quad \forall v \in \calV.
\end{align*}
With the variational formulation~\eqref{eq:posnd_gen_weak}, unlike with the strong formulation~\eqref{eq:posnd_gen_strong}, we need not assume any smoothness of the coefficients $a$, $b$, or $c$.  We only require that the coefficients are bounded: $a \in (L^\infty(\Omega))^{d \times d}$, $b \in (L^\infty(\Omega))^d$, and $c \in L^\infty(\Omega)$.

As discussed in Section~\ref{sec:posnd_inhomo_bc}, in practice, the inhomogeneous Dirichlet boundary conditions are more conveniently treated through the decomposition of the solution as $u = u^E + \tilde u$ for some arbitrary but fixed $u^E \in \calV^E$ so that $u^E|_{\Gamma_D} = u^B$ and $\tilde u \in \calV$.  We then consider the following variational problem: find $\tilde u \in \calV$ such that
\begin{equation*}
  a(\tilde u,v) = \tilde \ell(v) \quad \forall v \in \calV,
\end{equation*}
where $\tilde \ell: \calV \to \RR$ is the modified linear form such that $\tilde \ell(v) \equiv \ell(v) - a(u^E,v)$, $\forall v \in \calV$; we then set $u = u^E + \tilde u$. 

%% We note that it is also possible to perform the procedure in reverse: we start from the variational form and then identify the associated strong form. Specifically, we start with the variational form, and invoke the integration by parts to identify the PDE and boundary conditions: for all $v \in \calV$,
%% \begin{align*}
%%   0 &=
%%   a(u,v) - \ell(v)
%%   =
%%   \int_\Omega \nabla v \cdot \nabla u dx + \int_{\Gamma_R} k vu ds
%%   - \int_\Omega fv dx - \int_{\Gamma_N} gv ds - \int_{\Gamma_R} qv ds
%%   \\
%%   &= \int_\Omega v (-\Delta u) dx + \int_{\partial \Omega} v \pp{u}{n} ds
%%   + \int_{\Gamma_R} k vu ds
%%   - \int_\Omega fv dx - \int_{\Gamma_N} gv ds - \int_{\Gamma_R} qv ds
%%   \\
%%   &=
%%   \int_\Omega v(-\Delta u - f) dx
%%   + \underbrace{\int_{\Gamma_D} v \pp{u}{n} ds}_{=0 \text{ since $v \in \calV$}}
%%   + \int_{\Gamma_N} v (\pp{u}{n} - g) ds
%%   + \int_{\Gamma_R} v (\pp{u}{n} + ku - q) ds.
%% \end{align*}
%% In order for the statement to hold for \emph{all} $v \in \calV$, we need each of the integrals to vanish.  The condition requires that
%% \begin{align*}
%%   -\Delta u &= f \quad \text{in } \Omega \\
%%   \pp{u}{n} &= g \quad \text{on } \Gamma_N \\
%%   \pp{u}{n} + ku &= q \quad \text{on } \Gamma_R.
%% \end{align*}
%% We have identified (i) the PDE, (ii) the Neumann boundary condition on $\Gamma_N$, and (iii) the Robin boundary condition on $\Gamma_R$.  Finally, because $u \in \calV^E \equiv \{ u \in H^1(\Omega) \ | \ u|_{\Gamma_D} = u^B \}$, we have
%% \begin{equation*}
%%   u|_{\Gamma_D} = u^B \quad \text{on } \Gamma_D,
%% \end{equation*}
%% which is the Dirichlet boundary condition on $\Gamma_D$.

\section{Well-posedness of the weak formulation}
We now address a fundamental question: what conditions should a weak formulation satisfy to guarantee the existence \emph{and} uniqueness of the solution?  We recall that, in general, a weak formulation is defined by a test space $\calV$, trial space $\calV^E \equiv u^E + \calV$, bilinear form $a(\cdot,\cdot)$, and linear form $\ell(\cdot)$; as such, we wish to identify conditions that these ingredients must satisfy to ensure the existence and uniqueness of the solution.

We first provide a few definitions that characterize a linear form and bilinear form.
\begin{definition}[dual norm and continuity]
  The dual norm of a linear functional $\ell \in \calV'$ is given by
  \begin{equation*}
    \| \ell \|_{\calV'} \equiv \sup_{v \in \calV} \frac{|\ell(v)|}{\| v \|_\calV}.
  \end{equation*}
  A linear functional is said to be \emph{continuous} if $\| \ell \|_{\calV'} < \infty$.
\end{definition}
\begin{corollary}
  If a linear form $\ell \in \calV'$ is continuous so that $\| \ell \|_{\calV}' < \infty$, then
  \begin{equation*}
    |\ell(v)| \leq \| \ell \|_{\calV'} \| v \|_\calV \quad \forall v \in \calV.
  \end{equation*}
  In other words, a linear form is continuous if $\exists c < \infty$ such that $| \ell(v) | \leq c \| v \|_\calV$, $\forall v \in \calV$.
\end{corollary}
\begin{definition}[continuity]
  \label{def:th_continuity}
  A bilinear form $a: \calV \times \calV \to \RR$ is said to be continuous on $\calV$ (or $\calV$-continuous) if $\exists \gamma < \infty$ such that 
  \begin{equation*}
    a(w,v) \leq \gamma \| w \|_\calV \| v \|_\calV \quad \forall w,v \in \calV,
  \end{equation*}
\end{definition}
\begin{definition}[coercivity]
  \label{def:th_coercivity}
  A bilnear form $a: \calV \times \calV \to \RR$ is said to be coercive on $\calV$ (or $\calV$-coercive) if $\exists \alpha > 0$ such that 
  \begin{equation*}
    a(v,v) \geq \alpha \| v \|_\calV^2 \quad \forall v \in \calV.
  \end{equation*}
\end{definition}
The following theorem provides an answer to the question regarding the existence and uniqueness of a weak solution.
\begin{theorem}[Lax-Milgram]
  \label{thm:lax_milgram}
  Given a Hilbert space $\calV$, a continuous, coercive bilinear form $a: \calV \times \calV \to \RR$, and a continuous linear functional $\ell \in \calV'$, there exists a unique $u \in \calV$ such that
  \begin{equation}
    a(u,v) = \ell(v) \quad \forall v \in \calV.
    \label{eq:posnd_lax_milgram}
  \end{equation}
  \begin{proof}
    The proof of existence is beyond the scope of this course.  We refer to Brenner and Scott (2008).

    The proof of uniqueness is as follows. Suppose we have two solutions $u_1 \in \calV$ and $u_2 \in \calV$ that are distinct ($u_1 \neq u_2$) and satisfy~\eqref{eq:posnd_lax_milgram}: i.e., $a(u_1,v) = \ell(v)$, $\forall v \in \calV$, and $a(u_2,v) = \ell(v)$, $\forall v \in \calV$. The subtraction of the two equations yields $a(u_1,v) - a(u_2,v) = 0$, $\forall v \in \calV$.  We then invoke bilinearity to obtain $a(u_1 - u_2,v) = 0$, $\forall v \in \calV$. We then choose $v = u_1 - u_2$, which yields $a(u_1 - u_2, u_1 - u_2) = 0$.  The coercivity of the bilinear form implies that $a(u_1 - u_2, u_1 - u_2) \geq \alpha \| u_1 - u_2 \|^2_\calV$; since the left hand side is $0$, we obtain $\| u_1 - u_2 \|^2_\calV = 0$.  Hence, we arrive at the contradiction: $u_1 = u_2$.  If two solutions satisfy~\eqref{eq:posnd_lax_milgram}, then they must be the same; the solution to~\eqref{eq:posnd_lax_milgram} is unique.
  \end{proof}
\end{theorem}
The Lax-Milgram theorem provides sufficient conditions under which a weak formulation possess a unique solution.  We however note that these are only sufficient, and not necessary, conditions.  The above proof for uniqueness also shows how certain properties of the ingredients, such as bilinearity and coercivity, are used to prove the desired result.


The Lax-Milgram theorem concerns with the existence and uniqueness of a weak solution.  We now introduce a \emph{stability} or \emph{well-posedness} result which shows that the solution $u$ depends continuously on the data $\ell(\cdot)$.
\begin{proposition}[stability]
  Suppose the conditions of the Lax-Milgram theorem, Theorem~\ref{thm:lax_milgram}, are satisfied. Then, the solution $u$ satisfies
  \begin{equation*}
    \| u \|_\calV \leq \frac{1}{\alpha} \| \ell \|_{\calV'},
  \end{equation*}
  where $\alpha$ is the coercivity constant.
  \begin{proof}
    The proof is trivial for $\| u \|_\calV = 0$. For $\| u \|_\calV \neq 0$, we appeal to the coercivity of the bilinear form and the continuity of the linear form:
    \begin{equation*}
      \alpha \| u \|_\calV^2 \leq a(u,u) = \ell(u) \leq \| \ell \|_{\calV'} \| u \|_\calV.
    \end{equation*}
    The division by $\| u \|_\calV \neq 0$ yields the desired result.
  \end{proof}
\end{proposition}
\begin{corollary}
  Suppose the conditions of the Lax-Milgram theorem, Theorem~\ref{thm:lax_milgram}, are satisfied.  In addition, consider two linear forms $\ell_1(\cdot)$ and $\ell_2(\cdot)$, and the associated solutions $u_1$ and $u_2$.  Then, the difference in the solutions, $u_1 - u_2$, is bounded by the difference in the data, $\ell_1 - \ell_2$:
  \begin{equation*}
    \| u_1 - u_2 \|_\calV \leq \frac{1}{\alpha} \| \ell_1 - \ell_2 \|_{\calV'}.
  \end{equation*}
\end{corollary}
The stability result shows that the energy norm of the solution $u$ is bounded by the dual norm of the data $\ell$.  The closely related result in the corollary can be interpreted to mean that a small disturbance in the data $\ell$ results in a small perturbation in the solution $u$.


Before we conclude this section, we remark on the well-posedness of problems with inhomogeneous Dirichlet data.  The Lax-Milgram theorem~\ref{thm:lax_milgram} requires both the test and trial spaces to be a Hilbert space and in particular linear. We however recall that the trial space for a problem with inhomogeneous Dirichlet data is an affine space $\calV^E \equiv u^E + \calV$ for some fixed $u^E \in H^1(\Omega)$ and a linear space $\calV$. To prove the existence and uniqueness of the solution, we rely on the reformulated variational formulation \eqref{eq:posnd_inhomo_bc_var_reform}, which decomposes the solution $u \in \calV^E$ as $u = u^E + \tilde u$ for an arbitrary (but fixed $u^E$) and $\tilde u \in \calV$.  We specifically apply the Lax-Milgram theorem to the problem for $\tilde u$: find $\tilde u \in \calV$ such that
  \begin{equation*}
    a(\tilde u, v) = \tilde \ell(v) \quad \forall v \in \calV,
  \end{equation*}
  where $\tilde \ell: \calV \to \RR$ is the reformulated linear form $\tilde \ell(v) \equiv \ell(v) - a(u^E,v)$, $\forall v \in \calV$. By the Lax-Milgram theorem, a unique solution to the problem exists if $a:\calV \times \calV \to \RR$ is coercive and continuous, and $\tilde \ell \in \calV'$ is continuous. The latter requires that $\exists C < \infty$ such that $|\tilde \ell(v)| \leq C\| v \|_\calV$, $\forall v \in \calV$.  We now observe that, assuming $\ell(\cdot)$ and $a(\cdot,\cdot)$ are continuous, 
  \begin{align*}
    | \tilde \ell(v) | \equiv | \ell(v) - a(u^E,v) |
    \leq | \ell(v) | + | a(u^E,v) |
    \leq c \| v \|_{\calV} + \gamma \| u^E \|_{\calV} \| v \|_{\calV}
    = (c + \gamma \| u^E \|_{\calV}) \| v \|_{\calV},
  \end{align*}
  where $c$ and $\gamma$ are the continuity constant for $\ell(\cdot)$ and $a(\cdot,\cdot)$, respectively.  Hence $\tilde \ell(\cdot)$ is continuous under these assumptions, and we can apply the Lax-Milgram theorem to show the existence and uniqueness of $\tilde u \in \calV$ and in turn $u = u^E + \tilde u \in \calV^E$.

\section{Poincar\'e-Friedrichs and trace inequalities}
The proof of existence and uniqueness of a weak solution using the Lax-Milgram theorem relies on the continuity and coercivity of the bilinear form and the continuity of the linear form.  For many bilinear forms associated with boundary value problems, the verification of coercivity relies on the Poincar\'e-Friedrichs inequality.
\begin{proposition}[Poincar\'e-Friedrichs inequality]
  \label{prop:posnd_friedrichs}
  Let $\Omega \subset \RR^d$ be a Lipschitz domain, and suppose $\Gamma \subset \partial \Omega$ and $\Gamma \neq \emptyset$. Then, there exists a constant $C_{\rm PF} < \infty$ that only depends on $\Omega$ and $\Gamma$ such that
  \begin{equation*}
    \| v \|_{L^2(\Omega)}^2 \leq C_{\rm PF} ( | v |^2_{H^1(\Omega)} + \| v \|^2_{L^2(\Gamma)} )  \quad \forall v \in H^1(\Omega).
  \end{equation*}
  \begin{proof}
    Proof of the proposition is beyond the scope of this course.  We refer to Brenner and Scott (2008).
  \end{proof}
\end{proposition}
\begin{corollary}
  \label{cor:posnd_friedrichs_1}
  Let $\Omega \subset \RR^d$ be a Lipschitz domain, and suppose $\Gamma_D \subset \partial \Omega$ and $\Gamma_D \neq \emptyset$.   Let $\calV \equiv \{ v \in H^1(\Omega) \ | \ v|_{\Gamma_D} = 0 \}$.  Then, there exists a constant $C_{\rm PF} < \infty$ that depends only on $\Omega$ and $\Gamma_D$ such that
  \begin{equation*}
    %\| v \|_{H^1(\Omega)} \leq C | v |_{H^1(\Omega)} \quad \forall v \in \calV.
    \| v \|_{L^2(\Omega)} \leq C_{\rm PF} | v |_{H^1(\Omega)} \quad \forall v \in \calV.
  \end{equation*}
\end{corollary}
\begin{corollary}
  \label{cor:posnd_friedrichs_2}
  Let $\Omega \in \RR^d$ be a Lipschitz domain. Then, there exists a constant $C_{\rm PF} < \infty$ that depends on only $\Omega$ such that
  \begin{equation*}
    \| v \|_{L^2(\Omega)} \leq C_{\rm PF} | v |_{H^1(\Omega)} \quad \forall v \in H^1_0(\Omega).
  \end{equation*}
\end{corollary}
Proposition~\ref{prop:posnd_friedrichs} allows us to bound the $L^2(\Omega)$ norm of a function by the $H^1(\Omega)$ \emph{semi}-norm of the function and the $L^2(\Gamma)$ norm of the trace of the function on a portion of the boundary, $\Gamma \subset \partial \Omega$.  Corollaries~\ref{cor:posnd_friedrichs_1}~(and~\ref{cor:posnd_friedrichs_2}) are specializations of the results for functions that vanish on a portion (and whole) of the boundary such that $\| u \|_{L^2(\Gamma_D)} = 0$.  Intuitively, the corollaries bound the (integrated) value of the function by the (integrated) gradient of the function, assuming that the function is ``pinned'' to vanish over a portion of the boundary.
%The special case of Proposition~\ref{prop:th_poincare_gen} for $\Gamma_D \equiv \partial \Omega$ is known as the \emph{Poincar\'e inequality}.
\begin{remark}[Naming of the Poincar\'e-Friedrichs inequality]
  Proposition~\ref{cor:posnd_friedrichs_1} and the related results, such as Corollaries~\ref{cor:posnd_friedrichs_1}~and~\ref{cor:posnd_friedrichs_2}, are sometimes called just Poincar\'e inequality or Friedrichs inequality.  In this note, we will refer to inequalities of these types collectively as Poincar\'e-Friedrichs inequalities.
\end{remark}

For many bilinear forms associated with boundary value problems, the verification of continuity relies on the trace inequality.
\begin{proposition}[trace inequality]
  \label{prop:posnd_trace_ineq}
  Let $\Omega \subset \RR^d$ be a Lipschitz domain. Then, there exists a constant $C_{\rm tr} < \infty$ that depends only on $\Omega$ such that
  \begin{equation*}
    \| v \|_{L^2(\partial \Omega)} \leq C_{\rm tr} \| v \|_{H^1(\Omega)} \quad \forall v \in H^1(\Omega).
  \end{equation*}
    \begin{proof}
    Proof of the proposition is beyond the scope of this course.  We refer to Brenner and Scott (2008).
  \end{proof}
\end{proposition}
The trace inequality is particularly useful when we wish to show continuity of a linear or bilinear form which involves integration over (a part of) the boundary.


\section{Example: well-posedness of a Poisson problem}
\label{eq:posnd_wellposedness_example}
We now demonstrate the application of the Lax-Milgram theorem to prove that the mixed Poisson problem considered in Section~\ref{sec:posnd_mixed} is well-posed.  The problem is reproduced here for convenience.  Let $\Omega \subset \RR^d$ be a Lipschitz domain, $\Gamma_D$ and $\Gamma_N$ be Dirichlet and Neumann boundaries such that $\overline{\partial \Omega} = \overline{\Gamma}_D \cup \overline{\Gamma}_N$ and $\Gamma_D \neq \emptyset$, and $\calV \equiv \{ v \in H^1(\Omega) \ | \ v|_{\Gamma_D} = 0 \}$.  Find $u \in \calV$ such that
\begin{equation*}
  a(u,v) = \ell(v) \quad \forall v \in \calV,
\end{equation*}
where
\begin{align*}
  a(w,v) &= \int_\Omega \nabla v \cdot \nabla w dx \quad \forall w,v \in \calV, \\
  \ell(v) &= \int_\Omega v f dx + \int_{\Gamma_N} v g ds \quad \forall v \in \calV
\end{align*}
for $f \in L^2(\Omega)$ and $g \in L^2(\Gamma_N)$.  The space $\calV$ is endowed with the standard $H^1(\Omega)$ inner product and norm; i.e., $(\cdot,\cdot)_\calV \equiv (\cdot,\cdot)_{H^1(\Omega)}$ and $\| \cdot \|_\calV \equiv \| \cdot \|_{H^1(\Omega)}$.

We first show that the bilinear form is continuous: $\forall w,v \in \calV$, 
\begin{equation*}
  a(w,v)
  =
  \int_\Omega \nabla v \cdot \nabla w dx
  \leq
  \| \nabla v \|_{L^2(\Omega)} \| \nabla w \|_{L^2(\Omega)}
  =
  | v |_{H^1(\Omega)} | w |_{H^1(\Omega)}
  \leq
  \| v \|_{H^1(\Omega)} \| w \|_{H^1(\Omega)};
\end{equation*}
here, the first inequality follows from Cauchy-Schwarz, and the last inequality follows from $| v |_{H^1(\Omega)}^2 \leq | v |_{H^1(\Omega)}^2 + \| v \|_{L^2(\Omega)}^2 \equiv \| v \|_{H^1(\Omega)}^2$.  Hence, the bilinear form is continuous with the continuity constant $C = 1$.
We next show that the bilinear form is coercive: $\forall v \in \calV$,
\begin{equation*}
  \| v \|^2_{H^1(\Omega)} = | v |^2_{H^1(\Omega)} + \| v \|^2_{L^2(\Omega)}
  \leq | v |^2_{H^1(\Omega)} + C_{\rm PF}^2 | v |^2_{H^1(\Omega)}
  = (1 + C_{\rm PF}^2) a(v,v),
\end{equation*}
where $C_{\rm PF} < \infty$ is the constant associated with the (corollary of the) Poincar\'e-Friedrichs inequality, Corollary~\ref{cor:posnd_friedrichs_1}.  It follows that $(1+C_{\rm PF}^2)^{-1}\| v \|^2_{H^1(\Omega)} \leq a(v,v)$, $\forall v \in \calV$.  Hence, the bilinear from is coercive with the coercivity constant  $\alpha = (1 + C_{\rm PF}^2)^{-1}$.  We now show that the volume source term of the linear form is continuous: $\forall v \in \calV$,
\begin{align}
  |\int_\Omega vf dx|
  \leq \| v \|_{L^2(\Omega)} \| f \|_{L^2(\Omega)}
  \leq \| f \|_{L^2(\Omega)} \| v \|_{H^1(\Omega)};
  \label{eq:posnd_example_f}
%  \| \int_{\Omega} \cdot\,f dx \|_{\calV'}
%  &\equiv \sup_{v \in \calV}
%  \frac{|\int_\Omega v f dx|}{\| v \|_{H^1(\Omega)}}
%  \leq \sup_{v \in \calV} \frac{\| v \|_{L^2(\Omega)} \| f \|_{L^2(\Omega)}}{\| v \|_{H^1(\Omega)}}
%  \leq\| f \|_{L^2(\Omega)} < \infty; %+ C_{\rm tr}\| g \|_{L^2(\Omega)}< \infty;
\end{align}
here, the first inequality follows from Cauchy-Schwarz, and the second inequality follows from $\| v\|_{L^2(\Omega)} \leq (\| v \|^2_{L^2(\Omega)} + | v |_{H^1(\Omega)}^2)^{1/2} = \| v \|_{H^1(\Omega)}^2$, $\forall v \in \calV$. We then show that the Neumann boundary term of the linear form is continuous: $\forall v \in \calV$,
\begin{align}
  |\int_{\Gamma_N} vgds|
  \leq \| v \|_{L^2(\Gamma_N)} \| g \|_{L^2(\Gamma_N)}
  \leq C_{\rm tr} \| g \|_{L^2(\Gamma_N)}  \| v \|_{H^1(\Omega)};
  \label{eq:posnd_example_g}
%  \| \int_{\Gamma_N} \cdot\,g ds \|_{\calV'}
%  &\equiv \sup_{v \in \calV}
%  \frac{|\int_{\Gamma_N} v g ds|}{\| v \|_{H^1(\Omega)}}
%  \leq \sup_{v \in \calV} \frac{ \| v \|_{L^2(\Gamma_N)} \| g \|_{L^2(\Gamma_N)}}{\| v \|_{H^1(\Omega)}}
%  \leq \sup_{v \in \calV} \frac{C_{\Omega} \| v \|_{H^1(\Omega)} \| g \|_{L^2(\Gamma_N)} }{\| v \|_{H^1(\Omega)}}
%  \\
%  &\leq C_{\Omega}\| g \|_{L^2(\Omega)}< \infty;
\end{align}
here, the first inequality follows from Cauchy-Schwarz, and the second inequality follows from the trace inequality, Proposition~\ref{prop:posnd_trace_ineq}. The combination of \eqref{eq:posnd_example_f} and \eqref{eq:posnd_example_g} yields, $\forall v \in \calV$,
\begin{equation*}
  | \ell(v) | \leq | \int_\Omega vf dx | + |\int_{\Gamma_N} vg ds|
  \leq  (\| f \|_{L^2(\Omega)} + C_{\rm tr} \| g \|_{L^2(\Gamma_N)}) \| v \|_{H^1(\Omega)};
\end{equation*}
hence the linear form $\ell(\cdot)$ is continuous with the continuity constant $c =  \| f \|_{L^2(\Omega)} + C_{\rm tr} \| g \|_{L^2(\Gamma_N)}$.  We confirm that all conditions of the Lax-Milgram theorem are satisfied; hence the Poisson problem has a unique solution, and the problem is well-posed.

\section{Minimization formulation}
We now obtain the minimization formulation for boundary value problems under two assumptions on the bilinear form $a(\cdot,\cdot)$:
\begin{itemize}
\item[1.] coercivity: $\exists \alpha > 0$ such that $a(v,v) \geq \alpha\| v \|^2_\calV$, $\forall v \in \calV$.
\item[2.] symmetry: $a(w,v) = a(v,w)$, $\forall w,v, \in \calV$.
\end{itemize}
Our variational formulation is as follows: find $u \in \calV^E$ such that
\begin{equation}
  a(u,v) = \ell(v) \quad \forall v \in \calV,
  \label{eq:posnd_energy_var}
\end{equation}
where $\calV^E \equiv  \{ v \in H^1(\Omega) \ | \ v|_{\Gamma_D} = u^B\}$ for some boundary function $u^B$, $ \calV \equiv \{ v \in H^1(\Omega) \ | \ v|_{\Gamma_D} = 0 \}$, and a continuous linear form $\ell: \calV \to \RR$.
  We then introduce an energy functional, $J: H^1(\Omega) \to \RR$, given by
\begin{equation}
  J(w) \equiv \frac{1}{2} a(w,w) - \ell(w) \quad \forall w \in H^1(\Omega).
  \label{eq:posnd_energy_fun}
\end{equation}
 We then have the following minimization formulation: find $u \in \calV^E$ such that
\begin{equation}
  u = \argmin_{w \in \calV^E} J(w).
  \label{eq:posnd_energy_min}
\end{equation}
This is a minimization formulation for a general symmetric, coercive problem.

We can readily show that $u \in \calV$ is the solution to the minimization problem~\eqref{eq:posnd_energy_min} if and only if it is the solution to the variational problem~\eqref{eq:posnd_energy_var}. Suppose $u \in \calV^E$ is the solution to the variational problem~\eqref{eq:posnd_energy_var}. Let $w = u + v$ for some $v \in \calV$.  (Note that $w \in \calV^E$.)  We then observe, $\forall v \in \calV$,
\begin{align*}
  J(w)
  &=
  J(u+v)
  =
  \frac{1}{2} a(u+v,u+v) - \ell(u+v)
  \\
  &=
  \underbrace{\frac{1}{2} a(u,u) - \ell(u)}_{J(u)} + \underbrace{ \frac{1}{2} a(u,v) + \frac{1}{2} a(v,u)}_{= a(u,v) \text{ by symmetry}} - \ell(v) + \frac{1}{2} a(v,v)
  \\
  &=
  J(u) + \underbrace{ a(u,v) - \ell(v) }_{= 0 \text{ since $u$ solves \eqref{eq:posnd_energy_var}}} + \underbrace{ \frac{1}{2} a(v,v) }_{\substack{> 0 \text{ for $v \neq 0$}\\\text{by coercivity}}} > J(u) \quad \forall v \neq 0.
\end{align*}
Hence, $J(w) > J(u)$ for all $w \neq u$, and $u$ is the minimizer of $J$ \eqref{eq:posnd_energy_fun}.  Note that this proof relies on the fact that the bilinear form is symmetric and coercive.

Conversely, suppose $u \in \calV^E$ is the solution to the minimization problem~\eqref{eq:posnd_energy_min}. Because the energy functional is quadratic in the argument, the minimizer $u$ must satisfy the stationarity condition
\begin{equation*}
  J'(u;v) \equiv \lim_{\epsilon \to 0} \frac{1}{\epsilon}(J(u+\epsilon v) - J(u)) = 0 \quad \forall v \in \calV;
\end{equation*}
the Fr\'echet derivative (i.e., directional derivative) about $u$ in any direction $v$ should be 0. The Fr\'echet derivative $J'(u;v)$ is given by
\begin{align*}
  J'(u;v)
  &\equiv
  \lim_{\epsilon \to 0} \frac{1}{\epsilon}(J(u+\epsilon v) - J(u))
  = \lim_{\epsilon \to 0} \frac{1}{\epsilon}(J(u) + a(u,\epsilon v) - \ell(\epsilon v) + \frac{1}{2} a(\epsilon v, \epsilon v) - J(u))
  \\
  &= \lim_{\epsilon \to 0} \frac{1}{\epsilon} (\epsilon a(u,v) - \epsilon \ell(v) + \frac{1}{2} \epsilon^2 a(v,v))
  = \lim_{\epsilon \to 0} (a(u,v) - \ell(v) + \frac{1}{2} \epsilon a(v,v))
  = a(u,v) - \ell(v) 
\end{align*}
Hence, for $u \in \calV^E$ to be the minimizer, it must satisfy
\begin{equation*}
  J'(u;v) = a(u,v) - \ell(v) = 0, \forall v \in \calV,
\end{equation*}
which is precisely the variational statement~\eqref{eq:posnd_energy_var}.

%Note that the equivalence of the minimization formulation~\eqref{eq:posnd_energy_min} and the variational formulation~\eqref{eq:posnd_energy_var} relies on the symmetry and coercivity of the bilinear form.

\section{Summary}
We summarize key points of this lecture:
\begin{enumerate}
\item A Hilbert space is a complete inner-product space; a Banach space is a complete normed space.
\item The Lebesgue space $L^2(\Omega)$ consists of functions that are square integrable (in the Lebesgue sense).
\item The Sobolev space $H^k(\Omega)$ consists of functions whose (weak) derivatives of up to and including order $k$ are square integrable (in the Lebesgue sense).
\item The $d$-dimensional Poisson equation can be cast in the strong, minimization, or variational (or weak) form.
\item A Dirichlet boundary condition is an essential boundary condition that is imposed strongly by the choice of the space.  Neumann and Robin boundary conditions are natural boundary conditions that are imposed weakly by the variational form.
\item Inhomogeneous Dirichlet boundary conditions are imposed strongly by an affine (and not linear) trial space.
\item The Lax-Milgram theorem shows the existence \emph{and} uniqueness of a solution for a weak formulation with a coercive and continuous bilinear from and a continuous linear form.
\item The verification of coercivity and continuity of a bilinear form often relies on a Poincar\'e-Friedrichs-type inequality and trace inequality, respectively.
\item If a variational formulation is given by a symmetric, coercive bilinear form, then it has a minimization formulation.
\end{enumerate}


%% \section{Finite element approximation}
%% We now wish to obtain a finite element approximation of the variational form~\eqref{eq:posnd_poisson_nd_weak} or, equivalently, the minimization form~\eqref{eqpoisson_nd_min}. To this end, we first introduce a conforming \emph{tessellation} (or \emph{triangulation}) of $\Omega \subset \RR^d$ into $N_e$ non-overlapping elements $\kappa_1, \dots, \kappa_{N_e}$:
%% \begin{equation*}
%%   \calT_h \equiv \{ \kappa_i \}_{i=1}^{N_e}.
%% \end{equation*}
%% A tessellation $\calT_h$ is characterized by a maximum diameter of the elements that comprise the set: $h \equiv \max_{i} \text{dia}(\kappa_i)$.

%% We now introduce a space of piecewise linear functions associated with 
%% \begin{equation*}
%%   \calV_h \equiv \{ v \in \calV \ | v |_{\kappa_i} \in \PP^1(\kappa_i), \ i = 1,\dots, N_e \}.
%% \end{equation*}

%% \begin{equation*}
%%   \calV_h = \text{span} \{ \phi_i \}_{i=1}^N.
%% \end{equation*}

%% \begin{equation*}
%%   a_{\kappa}(w,v) \equiv a(w|_{\kappa},v|_{\kappa_i})
%%   = \int_\kappa \nabla v \cdot \nabla w dx \quad \kappa \in \calT_h
%%   \\
%%   \ell_\kappa(w,v) \equiv \ell(v|_{\kappa_i})
%%   = \int_\kappa v f dx \quad \kappa \in \calT_h.
%% \end{equation*}


%% $A_h \in \RR^{N \times N}$ and $f_h \in \RR^{N}$ such that
%% \begin{align*}
%%   A_{h,ij} &= a(\phi_j,\phi_i) \quad i,j = 1,\dots,N, \\
%%   F_{h,i} &= \ell(\phi_i) \quad i = 1,\dots,N.
%% \end{align*}



%% We first introduce a strong 


%% To obtain a variational form of the problem, we first multiply the strong form of the PDE with a test function $v$, integrated the $v$-weighted expression, and integrate by parts the Laplacian operator:
%% \begin{align*}
%%   \int_{\Omega} v (-\Delta u - f) dx
%%   =
%%   \int_{\Omega} (\nabla v \cdot \nabla u - v f) dx
%%   - \underbrace{\int_{\Gamma_D} v \pp{u}{n} ds}_{\text{(D)}}
%%   - \underbrace{\int_{\Gamma_N} v \pp{u}{n} ds}_{\text{(N)}}
%%   - \underbrace{\int_{\Gamma_R} v \pp{u}{n} ds}_{\text{(R)}}
%% \end{align*}
%% We now impose the three boundary conditions. The (inhomogeneous) Dirichlet boundary condition on $\Gamma_D$ is enforced strongly through the choice of the trial and test spaces.  Namely, we choose for our trial and test spaces
%% \begin{align*}
%%   \calV^E &\equiv \{ v \in H^1(\Omega) \ | \ v|_{\Gamma_D} = u^B \} \\
%%   \calV &\equiv \{ v \in H^1(\Omega) \ | \ v|_{\Gamma_D} = 0 \};
%% \end{align*}
%% note that the choice will result in the elimination of the boundary term (D) since $v|_{\Gamma_D} = 0$ for $v \in \calV$.
